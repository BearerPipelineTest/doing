<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Doing::WWID - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
  var index_rel_prefix = "../";
</script>

<script src="../js/navigation.js" defer></script>
<script src="../js/search.js" defer></script>
<script src="../js/search_index.js" defer></script>
<script src="../js/searcher.js" defer></script>
<script src="../js/darkfish.js" defer></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    
<div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  <p class="link">Object
</div>

    
<div id="includes-section" class="nav-section">
  <h3>Included Modules</h3>

  <ul class="link-list">
    <li><span class="include">Doing::Util</span>
  </ul>
</div>

    
    
<!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    <li ><a href="#method-c-new">::new</a>
    <li ><a href="#method-i-add_item">#add_item</a>
    <li ><a href="#method-i-add_section">#add_section</a>
    <li ><a href="#method-i-archive">#archive</a>
    <li ><a href="#method-i-autotag">#autotag</a>
    <li ><a href="#method-i-choose_from">#choose_from</a>
    <li ><a href="#method-i-choose_section">#choose_section</a>
    <li ><a href="#method-i-choose_view">#choose_view</a>
    <li ><a href="#method-i-chronify">#chronify</a>
    <li ><a href="#method-i-chronify_qty">#chronify_qty</a>
    <li ><a href="#method-i-colors">#colors</a>
    <li ><a href="#method-i-configure">#configure</a>
    <li ><a href="#method-i-create">#create</a>
    <li ><a href="#method-i-dedup">#dedup</a>
    <li ><a href="#method-i-delete_item">#delete_item</a>
    <li ><a href="#method-i-do_archive">#do_archive</a>
    <li ><a href="#method-i-edit_last">#edit_last</a>
    <li ><a href="#method-i-exec_available">#exec_available</a>
    <li ><a href="#method-i-find_local_config">#find_local_config</a>
    <li ><a href="#method-i-fmt_time">#fmt_time</a>
    <li ><a href="#method-i-fork_editor">#fork_editor</a>
    <li ><a href="#method-i-format_input">#format_input</a>
    <li ><a href="#method-i-get_end_date">#get_end_date</a>
    <li ><a href="#method-i-get_interval">#get_interval</a>
    <li ><a href="#method-i-get_view">#get_view</a>
    <li ><a href="#method-i-guess_section">#guess_section</a>
    <li ><a href="#method-i-guess_view">#guess_view</a>
    <li ><a href="#method-i-import">#import</a>
    <li ><a href="#method-i-init_doing_file">#init_doing_file</a>
    <li ><a href="#method-i-interactive">#interactive</a>
    <li ><a href="#method-i-last">#last</a>
    <li ><a href="#method-i-last_entry">#last_entry</a>
    <li ><a href="#method-i-last_note">#last_note</a>
    <li ><a href="#method-i-list_date">#list_date</a>
    <li ><a href="#method-i-list_section">#list_section</a>
    <li ><a href="#method-i-load_plugins">#load_plugins</a>
    <li ><a href="#method-i-move_item">#move_item</a>
    <li ><a href="#method-i-next_item">#next_item</a>
    <li ><a href="#method-i-note_last">#note_last</a>
    <li ><a href="#method-i-overlapping_time-3F">#overlapping_time?</a>
    <li ><a href="#method-i-plugin_names">#plugin_names</a>
    <li ><a href="#method-i-plugin_regex">#plugin_regex</a>
    <li ><a href="#method-i-plugin_templates">#plugin_templates</a>
    <li ><a href="#method-i-plugins">#plugins</a>
    <li ><a href="#method-i-read_config">#read_config</a>
    <li ><a href="#method-i-recent">#recent</a>
    <li ><a href="#method-i-record_tag_times">#record_tag_times</a>
    <li ><a href="#method-i-restart_last">#restart_last</a>
    <li ><a href="#method-i-restore_backup">#restore_backup</a>
    <li ><a href="#method-i-rotate">#rotate</a>
    <li ><a href="#method-i-same_time-3F">#same_time?</a>
    <li ><a href="#method-i-sections">#sections</a>
    <li ><a href="#method-i-stop_start">#stop_start</a>
    <li ><a href="#method-i-tag_item">#tag_item</a>
    <li ><a href="#method-i-tag_last">#tag_last</a>
    <li ><a href="#method-i-tag_times">#tag_times</a>
    <li ><a href="#method-i-template_for_trigger">#template_for_trigger</a>
    <li ><a href="#method-i-template_regex">#template_regex</a>
    <li ><a href="#method-i-today">#today</a>
    <li ><a href="#method-i-untag_item">#untag_item</a>
    <li ><a href="#method-i-update_item">#update_item</a>
    <li ><a href="#method-i-views">#views</a>
    <li ><a href="#method-i-write">#write</a>
    <li ><a href="#method-i-yesterday">#yesterday</a>
    <li ><a href="#method-i-yn">#yn</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Doing::WWID">
  <h1 id="class-Doing::WWID" class="class">
    class Doing::WWID
  </h1>

  <section class="description">
    
<p>@brief Main “What Was I Doing” methods</p>

  </section>

  <section id="5Buntitled-5D" class="documentation-section">



    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      <div id="attribute-i-auto_tag" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">auto_tag</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-config" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">config</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-config_file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">config_file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-content" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">content</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-current_section" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">current_section</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-default_config_file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">default_config_file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-doing_file" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">doing_file</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-interval_cache" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">interval_cache</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-recorded_items" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">recorded_items</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-results" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">results</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-timers" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">timers</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
      <div id="attribute-i-user_home" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">user_home</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        </div>
      </div>
    </section>


     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

      <div id="method-c-new" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">new</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Initializes the object.</p>

          <div class="method-source-code" id="new-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 22</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">initialize</span>
  <span class="ruby-ivar">@content</span> = {}
  <span class="ruby-ivar">@doingrc_needs_update</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-ivar">@default_config_file</span> = <span class="ruby-string">&#39;.doingrc&#39;</span>
  <span class="ruby-ivar">@interval_cache</span> = {}
  <span class="ruby-ivar">@results</span> = []
  <span class="ruby-ivar">@auto_tag</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-ivar">@plugins</span> = <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

      <div id="method-i-add_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">add_item</span><span
            class="method-args">(title, section = nil, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Adds an entry</p>

<p>@param title (String) The entry title @param section (String) The section to add to @param opt (Hash) Additional Options {:date, :note, :back, :timed}</p>

          <div class="method-source-code" id="add_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 540</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_item</span>(<span class="ruby-identifier">title</span>, <span class="ruby-identifier">section</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">section</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@current_section</span>
  <span class="ruby-identifier">add_section</span>(<span class="ruby-identifier">section</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:timed</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>] = [<span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>]] <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>].<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>)

  <span class="ruby-identifier">title</span> = [<span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">cap_first</span>]
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@auto_tag</span>
    <span class="ruby-identifier">title</span> = <span class="ruby-identifier">autotag</span>(<span class="ruby-identifier">title</span>)
    <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;default_tags&#39;</span>].<span class="ruby-identifier">empty?</span>
      <span class="ruby-identifier">default_tags</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;default_tags&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">nil?</span>

        <span class="ruby-identifier">dt</span> = <span class="ruby-identifier">t</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^ *@/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">chomp</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@#{dt}/</span>
          <span class="ruby-string">&#39;&#39;</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-node">&quot; @#{dt}&quot;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">default_tags</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span> }
      <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">default_tags</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/ +/</span>, <span class="ruby-string">&#39; &#39;</span>)
  <span class="ruby-identifier">entry</span> = { <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>, <span class="ruby-string">&#39;date&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] }
  <span class="ruby-identifier">entry</span>[<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:chomp</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>].<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:timed</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">reverse!</span>
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span>, <span class="ruby-identifier">x</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">i</span>[<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/ @done/</span>

      <span class="ruby-identifier">items</span>[<span class="ruby-identifier">x</span>][<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-node">&quot;#{i[&#39;title&#39;]} @done(#{opt[:back].strftime(&#39;%F %R&#39;)})&quot;</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">reverse!</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">items</span>
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added &quot;#{entry[&#39;title&#39;]}&quot; to #{section})</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-add_section" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">add_section</span><span
            class="method-args">(title)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Adds a section.</p>

<p>@param title (String) The new section title</p>

          <div class="method-source-code" id="add_section-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 419</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">add_section</span>(<span class="ruby-identifier">title</span>)
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">title</span>.<span class="ruby-identifier">cap_first</span>] = { <span class="ruby-string">&#39;original&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-node">&quot;#{title}:&quot;</span>, <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added section &quot;#{title.cap_first}&quot;)</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-archive" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">archive</span><span
            class="method-args">(section = @current_section, options = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Move entries from a section to Archive or other specified  section</p>

<p>@param section (String) The source section @param options (Hash) Options</p>

          <div class="method-source-code" id="archive-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1873</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">archive</span>(<span class="ruby-identifier">section</span> = <span class="ruby-ivar">@current_section</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">count</span>       = <span class="ruby-identifier">options</span>[<span class="ruby-value">:keep</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">destination</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:destination</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;Archive&#39;</span>
  <span class="ruby-identifier">tags</span>        = <span class="ruby-identifier">options</span>[<span class="ruby-value">:tags</span>] <span class="ruby-operator">||</span> []
  <span class="ruby-identifier">bool</span>        = <span class="ruby-identifier">options</span>[<span class="ruby-value">:bool</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:and</span>

  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">choose_section</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/choose/i</span>
  <span class="ruby-identifier">archive_all</span> = <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span> <span class="ruby-comment"># &amp;&amp; !(tags.nil? || tags.empty?)</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">archive_all</span>

  <span class="ruby-identifier">add_section</span>(<span class="ruby-string">&#39;Archive&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">destination</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^archive$/i</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">sections</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-string">&#39;Archive&#39;</span>)

  <span class="ruby-identifier">destination</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">destination</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">destination</span>) <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">section</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">archive_all</span>)
    <span class="ruby-identifier">do_archive</span>(<span class="ruby-identifier">section</span>, <span class="ruby-identifier">destination</span>, { <span class="ruby-value">count:</span> <span class="ruby-identifier">count</span>, <span class="ruby-value">tags:</span> <span class="ruby-identifier">tags</span>, <span class="ruby-value">bool:</span> <span class="ruby-identifier">bool</span>, <span class="ruby-value">search:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:search</span>], <span class="ruby-value">label:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:label</span>], <span class="ruby-value">before:</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:before</span>] })
    <span class="ruby-identifier">write</span>(<span class="ruby-identifier">doing_file</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;Either source or destination does not exist&#39;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-autotag" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">autotag</span><span
            class="method-args">(text)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Uses &#39;autotag&#39; configuration to turn keywords into tags for time tracking. Does not repeat tags in a title, and only converts the first instance of an untagged keyword</p>

<p>@param text (String) The text to tag</p>

          <div class="method-source-code" id="autotag-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2166</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">autotag</span>(<span class="ruby-identifier">text</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">text</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@auto_tag</span>

  <span class="ruby-identifier">current_tags</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/@\w+/</span>)
  <span class="ruby-identifier">whitelisted</span> = []
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>][<span class="ruby-string">&#39;whitelist&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@#{tag}\b/i</span>

    <span class="ruby-identifier">text</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/(?&lt;!@)(#{tag.strip})\b/i</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">m</span>.<span class="ruby-identifier">downcase!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/[a-z]/</span>
      <span class="ruby-identifier">whitelisted</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;@#{m}&quot;</span>)
      <span class="ruby-node">&quot;@#{m}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">tail_tags</span> = []
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>][<span class="ruby-string">&#39;synonyms&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">v</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">word</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">text</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\b#{word}\b/i</span>

      <span class="ruby-identifier">tail_tags</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">tag</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">current_tags</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;@#{tag}&quot;</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">whitelisted</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-node">&quot;@#{tag}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>].<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;transform&#39;</span>
    <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>][<span class="ruby-string">&#39;transform&#39;</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\S+:\S+/</span>

      <span class="ruby-identifier">rx</span>, <span class="ruby-identifier">r</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/:/</span>)
      <span class="ruby-identifier">r</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/\$/</span>, <span class="ruby-string">&#39;\\&#39;</span>)
      <span class="ruby-identifier">rx</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^@/</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-identifier">regex</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&#39;@&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">rx</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;\b&#39;</span>)

      <span class="ruby-identifier">matches</span> = <span class="ruby-identifier">text</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-identifier">regex</span>)
      <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">matches</span>

      <span class="ruby-identifier">matches</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">new_tag</span> = <span class="ruby-identifier">r</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Array</span>)
          <span class="ruby-identifier">index</span> = <span class="ruby-value">1</span>
          <span class="ruby-identifier">m</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
            <span class="ruby-identifier">new_tag</span> = <span class="ruby-identifier">new_tag</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-string">&#39;\\&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">index</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">v</span>)
            <span class="ruby-identifier">index</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">tail_tags</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">new_tag</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Whitelisted tags: #{whitelisted.join(&#39;, &#39;)}&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">whitelisted</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tail_tags</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tail_tags</span>.<span class="ruby-identifier">uniq</span>.<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-string">&#39;@&#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">t</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>)
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Synonym tags: #{tags}&quot;</span>)
    <span class="ruby-identifier">text</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39; &#39;</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tags</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">text</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-choose_from" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">choose_from</span><span
            class="method-args">(options, prompt: &#39;Make a selection: &#39;, multiple: false, fzf_args: [])</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Generate a menu of options and allow user selection</p>

<p>@return (String) The selected option</p>

          <div class="method-source-code" id="choose_from-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 743</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">choose_from</span>(<span class="ruby-identifier">options</span>, <span class="ruby-value">prompt:</span> <span class="ruby-string">&#39;Make a selection: &#39;</span>, <span class="ruby-value">multiple:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">fzf_args:</span> [])
  <span class="ruby-identifier">fzf</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../helpers/fuzzyfilefinder&#39;</span>)
  <span class="ruby-identifier">fzf_args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;-1&#39;</span>
  <span class="ruby-identifier">fzf_args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%(--prompt &quot;#{prompt}&quot;)</span>
  <span class="ruby-identifier">fzf_args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-string">&#39;--multi&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">multiple</span>
  <span class="ruby-identifier">header</span> = <span class="ruby-node">&quot;esc: cancel,#{multiple ? &#39; tab: multi-select, ctrl-a: select all,&#39; : &#39;&#39;} return: confirm&quot;</span>
  <span class="ruby-identifier">fzf_args</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-node">%(--header &quot;#{header}&quot;)</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-node">`echo #{Shellwords.escape(options.join(&quot;\n&quot;))}|#{fzf} #{fzf_args.join(&#39; &#39;)}`</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">size</span>.<span class="ruby-identifier">zero?</span>

  <span class="ruby-identifier">res</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-choose_section" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">choose_section</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Generate a menu of sections and allow user selection</p>

<p>@return (String) The selected section name</p>

          <div class="method-source-code" id="choose_section-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1636</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">choose_section</span>
  <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">choose_from</span>(<span class="ruby-identifier">sections</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-value">prompt:</span> <span class="ruby-string">&#39;Choose a section &gt; &#39;</span>, <span class="ruby-value">fzf_args:</span> [<span class="ruby-string">&#39;--height=60%&#39;</span>])
  <span class="ruby-identifier">choice</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">choice</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">choice</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-choose_view" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">choose_view</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Generate a menu of views and allow user selection</p>

<p>@return (String) The selected view name</p>

          <div class="method-source-code" id="choose_view-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1655</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">choose_view</span>
  <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">choose_from</span>(<span class="ruby-identifier">views</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-value">prompt:</span> <span class="ruby-string">&#39;Choose a view &gt; &#39;</span>, <span class="ruby-value">fzf_args:</span> [<span class="ruby-string">&#39;--height=60%&#39;</span>])
  <span class="ruby-identifier">choice</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">choice</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">choice</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-chronify" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">chronify</span><span
            class="method-args">(input)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Converts input string into a Time object when input takes on the  following formats:  - interval format e.g. &#39;1d2h30m&#39;, &#39;45m&#39; etc.  - a semantic phrase e.g. &#39;yesterday 5:30pm&#39;  - a strftime e.g. &#39;2016-03-15 15:32:04 PDT&#39;</p>

<p>@param input (String) String to chronify</p>

<p>@return (DateTime) result</p>

          <div class="method-source-code" id="chronify-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 351</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">chronify</span>(<span class="ruby-identifier">input</span>)
  <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Invalid time expression #{input.inspect}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">strip</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-identifier">secs_ago</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^(\d+)$/</span>)
               <span class="ruby-comment"># plain number, assume minutes</span>
               <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>
             <span class="ruby-keyword">elsif</span> (<span class="ruby-identifier">m</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^(?:(?&lt;day&gt;\d+)d)?(?:(?&lt;hour&gt;\d+)h)?(?:(?&lt;min&gt;\d+)m)?$/i</span>))
               <span class="ruby-comment"># day/hour/minute format e.g. 1d2h30m</span>
               [[<span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;day&#39;</span>], <span class="ruby-value">24</span> <span class="ruby-operator">*</span> <span class="ruby-value">3600</span>],
                [<span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;hour&#39;</span>], <span class="ruby-value">3600</span>],
                [<span class="ruby-identifier">m</span>[<span class="ruby-string">&#39;min&#39;</span>], <span class="ruby-value">60</span>]].<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">qty</span>, <span class="ruby-identifier">secs</span><span class="ruby-operator">|</span> <span class="ruby-identifier">qty</span> <span class="ruby-operator">?</span> (<span class="ruby-identifier">qty</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-identifier">secs</span>) <span class="ruby-operator">:</span> <span class="ruby-value">0</span> }.<span class="ruby-identifier">reduce</span>(<span class="ruby-value">0</span>, <span class="ruby-value">:+</span>)
             <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">secs_ago</span>
    <span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">secs_ago</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-constant">Chronic</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">input</span>, { <span class="ruby-value">context:</span> <span class="ruby-value">:past</span>, <span class="ruby-value">ambiguous_time_range:</span> <span class="ruby-value">8</span> })
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-chronify_qty" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">chronify_qty</span><span
            class="method-args">(qty)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Converts simple strings into seconds that can be added to a Time  object</p>

<p>@param qty (String) HH:MM or <a href="dhm">XX</a>[[<a href="XXm">XXhm]</a>] (1d2h30m, 45m,  1.5d, 1h20m, etc.)</p>

<p>@return (Integer) seconds</p>

          <div class="method-source-code" id="chronify_qty-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 381</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">chronify_qty</span>(<span class="ruby-identifier">qty</span>)
  <span class="ruby-identifier">minutes</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">case</span> <span class="ruby-identifier">qty</span>.<span class="ruby-identifier">strip</span>
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^(\d+):(\d\d)$/</span>
    <span class="ruby-identifier">minutes</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>).<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>
    <span class="ruby-identifier">minutes</span> <span class="ruby-operator">+=</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">when</span> <span class="ruby-regexp">/^(\d+(?:\.\d+)?)([hmd])?$/</span>
    <span class="ruby-identifier">amt</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>)
    <span class="ruby-identifier">type</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>).<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;m&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>)

    <span class="ruby-identifier">minutes</span> = <span class="ruby-keyword">case</span> <span class="ruby-identifier">type</span>.<span class="ruby-identifier">downcase</span>
              <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;m&#39;</span>
                <span class="ruby-identifier">amt</span>.<span class="ruby-identifier">to_i</span>
              <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;h&#39;</span>
                (<span class="ruby-identifier">amt</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>).<span class="ruby-identifier">round</span>
              <span class="ruby-keyword">when</span> <span class="ruby-string">&#39;d&#39;</span>
                (<span class="ruby-identifier">amt</span>.<span class="ruby-identifier">to_f</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span>).<span class="ruby-identifier">round</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">minutes</span>
              <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">minutes</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-colors" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">colors</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief A dictionary of colors</p>

<p>@return (String) ANSI escape sequence</p>

          <div class="method-source-code" id="colors-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1980</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">colors</span>
  <span class="ruby-identifier">color</span> = {}
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;black&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;30m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;red&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;31m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;green&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;32m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;yellow&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;33m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;blue&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;34m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;magenta&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;35m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;cyan&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;36m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;white&#39;</span>] = <span class="ruby-string">&quot;\033[0;0;37m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgblack&#39;</span>] = <span class="ruby-string">&quot;\033[40m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgred&#39;</span>] = <span class="ruby-string">&quot;\033[41m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bggreen&#39;</span>] = <span class="ruby-string">&quot;\033[42m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgyellow&#39;</span>] = <span class="ruby-string">&quot;\033[43m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgblue&#39;</span>] = <span class="ruby-string">&quot;\033[44m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgmagenta&#39;</span>] = <span class="ruby-string">&quot;\033[45m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgcyan&#39;</span>] = <span class="ruby-string">&quot;\033[46m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;bgwhite&#39;</span>] = <span class="ruby-string">&quot;\033[47m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldblack&#39;</span>] = <span class="ruby-string">&quot;\033[1;30m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldred&#39;</span>] = <span class="ruby-string">&quot;\033[1;31m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldgreen&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;32m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldyellow&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;33m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldblue&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;34m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldmagenta&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;35m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldcyan&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;36m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldwhite&#39;</span>] = <span class="ruby-string">&quot;\033[0;1;37m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgblack&#39;</span>] = <span class="ruby-string">&quot;\033[1;40m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgred&#39;</span>] = <span class="ruby-string">&quot;\033[1;41m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbggreen&#39;</span>] = <span class="ruby-string">&quot;\033[1;42m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgyellow&#39;</span>] = <span class="ruby-string">&quot;\033[1;43m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgblue&#39;</span>] = <span class="ruby-string">&quot;\033[1;44m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgmagenta&#39;</span>] = <span class="ruby-string">&quot;\033[1;45m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgcyan&#39;</span>] = <span class="ruby-string">&quot;\033[1;46m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;boldbgwhite&#39;</span>] = <span class="ruby-string">&quot;\033[1;47m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;softpurple&#39;</span>] = <span class="ruby-string">&quot;\033[0;35;40m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;hotpants&#39;</span>] = <span class="ruby-string">&quot;\033[7;34;40m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;knightrider&#39;</span>] = <span class="ruby-string">&quot;\033[7;30;40m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;flamingo&#39;</span>] = <span class="ruby-string">&quot;\033[7;31;47m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;yeller&#39;</span>] = <span class="ruby-string">&quot;\033[1;37;43m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;whiteboard&#39;</span>] = <span class="ruby-string">&quot;\033[1;30;47m&quot;</span>
  <span class="ruby-identifier">color</span>[<span class="ruby-string">&#39;default&#39;</span>] = <span class="ruby-string">&quot;\033[0;39m&quot;</span>
  <span class="ruby-identifier">color</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-configure" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">configure</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Read user configuration and merge with defaults</p>

<p>@param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="configure-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">configure</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-ivar">@timers</span> = {}
  <span class="ruby-ivar">@recorded_items</span> = []
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:ignore_local</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-ivar">@config_file</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-ivar">@user_home</span>, <span class="ruby-ivar">@default_config_file</span>)

  <span class="ruby-identifier">read_config</span>({ <span class="ruby-value">ignore_local:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:ignore_local</span>] })

  <span class="ruby-ivar">@config</span> = {} <span class="ruby-keyword">if</span> <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>] <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>][<span class="ruby-string">&#39;whitelist&#39;</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;autotag&#39;</span>][<span class="ruby-string">&#39;synonyms&#39;</span>] <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;doing_file&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;~/what_was_i_doing.md&#39;</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;current_section&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;Currently&#39;</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;config_editor_app&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;editor_app&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;plugin_path&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>

  <span class="ruby-comment"># @config[&#39;html_template&#39;] ||= {}</span>
  <span class="ruby-comment"># @config[&#39;html_template&#39;][&#39;haml&#39;] ||= nil</span>
  <span class="ruby-comment"># @config[&#39;html_template&#39;][&#39;css&#39;] ||= nil</span>
  <span class="ruby-comment"># @config[&#39;html_template&#39;][&#39;markdown&#39;] ||= nil</span>

  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>] <span class="ruby-operator">||=</span> {}
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;default&#39;</span>] <span class="ruby-operator">||=</span> {
    <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%Y-%m-%d %H:%M&#39;</span>,
    <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%date | %title%note&#39;</span>,
    <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>
  }
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;today&#39;</span>] <span class="ruby-operator">||=</span> {
    <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%_I:%M%P&#39;</span>,
    <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%date: %title %interval%note&#39;</span>,
    <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>
  }
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;last&#39;</span>] <span class="ruby-operator">||=</span> {
    <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%-I:%M%P on %a&#39;</span>,
    <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%title (at %date)%odnote&#39;</span>,
    <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">88</span>
  }
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;recent&#39;</span>] <span class="ruby-operator">||=</span> {
    <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%_I:%M%P&#39;</span>,
    <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%shortdate: %title (%section)&#39;</span>,
    <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">88</span>,
    <span class="ruby-string">&#39;count&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">10</span>
  }
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;views&#39;</span>] <span class="ruby-operator">||=</span> {
    <span class="ruby-string">&#39;done&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%_I:%M%P&#39;</span>,
      <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%date | %title%note&#39;</span>,
      <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>,
      <span class="ruby-string">&#39;section&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;All&#39;</span>,
      <span class="ruby-string">&#39;count&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>,
      <span class="ruby-string">&#39;order&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;desc&#39;</span>,
      <span class="ruby-string">&#39;tags&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;done complete cancelled&#39;</span>,
      <span class="ruby-string">&#39;tags_bool&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;OR&#39;</span>
    },
    <span class="ruby-string">&#39;color&#39;</span> <span class="ruby-operator">=&gt;</span> {
      <span class="ruby-string">&#39;date_format&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%F %_I:%M%P&#39;</span>,
      <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;%boldblack%date %boldgreen| %boldwhite%title%default%note&#39;</span>,
      <span class="ruby-string">&#39;wrap_width&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">0</span>,
      <span class="ruby-string">&#39;section&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Currently&#39;</span>,
      <span class="ruby-string">&#39;count&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-value">10</span>,
      <span class="ruby-string">&#39;order&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;asc&#39;</span>
    }
  }
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;marker_tag&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;flagged&#39;</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;marker_color&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;red&#39;</span>
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;default_tags&#39;</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;tag_sort&#39;</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;time&#39;</span>

  <span class="ruby-ivar">@current_section</span> = <span class="ruby-identifier">config</span>[<span class="ruby-string">&#39;current_section&#39;</span>]
  <span class="ruby-ivar">@default_template</span> = <span class="ruby-identifier">config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;default&#39;</span>][<span class="ruby-string">&#39;template&#39;</span>]
  <span class="ruby-ivar">@default_date_format</span> = <span class="ruby-identifier">config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;default&#39;</span>][<span class="ruby-string">&#39;date_format&#39;</span>]

  <span class="ruby-ivar">@config</span>[<span class="ruby-value">:include_notes</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">true</span>

  <span class="ruby-comment"># if ENV[&#39;DOING_DEBUG&#39;].to_i == 3</span>
  <span class="ruby-comment">#   if @config[&#39;default_tags&#39;].length &gt; 0</span>
  <span class="ruby-comment">#     exit_now! &quot;DEFAULT CONFIG CHANGED&quot;</span>
  <span class="ruby-comment">#   end</span>
  <span class="ruby-comment"># end</span>
  <span class="ruby-ivar">@plugins</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">plugin_config</span> = {}

  <span class="ruby-identifier">plugins</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">type</span>, <span class="ruby-identifier">plugins</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">plugins</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">plugin</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">plugin</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-value">:config</span>)
        <span class="ruby-identifier">plugin_config</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-identifier">plugin</span>[<span class="ruby-value">:config</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@config</span> = <span class="ruby-identifier">plugin_config</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-ivar">@config</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@config_file</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:rewrite</span>]
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-ivar">@config_file</span>, <span class="ruby-string">&#39;w&#39;</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">yf</span><span class="ruby-operator">|</span> <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">dump</span>(<span class="ruby-ivar">@config</span>, <span class="ruby-identifier">yf</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@config</span> = <span class="ruby-ivar">@local_config</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-ivar">@config</span>)

  <span class="ruby-ivar">@current_section</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;current_section&#39;</span>]
  <span class="ruby-ivar">@default_template</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;default&#39;</span>][<span class="ruby-string">&#39;template&#39;</span>]
  <span class="ruby-ivar">@default_date_format</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;default&#39;</span>][<span class="ruby-string">&#39;date_format&#39;</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-create" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">create</span><span
            class="method-args">(filename = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Create a new doing file</p>

          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 259</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">create</span>(<span class="ruby-identifier">filename</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">filename</span> = <span class="ruby-ivar">@doing_file</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">filename</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-identifier">filename</span>).<span class="ruby-identifier">size</span>.<span class="ruby-identifier">positive?</span>

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-string">&#39;w+&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;#{@current_section}:&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-dedup" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">dedup</span><span
            class="method-args">(items, no_overlap = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="dedup-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 605</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">dedup</span>(<span class="ruby-identifier">items</span>, <span class="ruby-identifier">no_overlap</span> = <span class="ruby-keyword">false</span>)

  <span class="ruby-identifier">combined</span> = []
  <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">combined</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">duped</span> = <span class="ruby-keyword">false</span>
    <span class="ruby-identifier">combined</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">comp</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">duped</span> = <span class="ruby-identifier">no_overlap</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">overlapping_time?</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">comp</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">same_time?</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">comp</span>)
      <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">duped</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># warn &quot;Skipping overlapping entry: #{item[&#39;title&#39;]}&quot; if duped</span>
    <span class="ruby-identifier">duped</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-delete_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">delete_item</span><span
            class="method-args">(old_item)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Delete an item from the index</p>

<p>@param old_item</p>

          <div class="method-source-code" id="delete_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1241</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">delete_item</span>(<span class="ruby-identifier">old_item</span>)
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">old_item</span>[<span class="ruby-string">&#39;section&#39;</span>]

  <span class="ruby-identifier">section_items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-identifier">deleted</span> = <span class="ruby-identifier">section_items</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">old_item</span>)
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Entry deleted: #{deleted[&#39;title&#39;]}&quot;</span>)
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">section_items</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-do_archive" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">do_archive</span><span
            class="method-args">(sect, destination, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Helper function, performs the actual archiving</p>

<p>@param section (String) The source section @param destination (String) The destination section @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="do_archive-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1902</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">do_archive</span>(<span class="ruby-identifier">sect</span>, <span class="ruby-identifier">destination</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">count</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">tags</span>  = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tags</span>] <span class="ruby-operator">||</span> []
  <span class="ruby-identifier">bool</span>  = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:bool</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:and</span>
  <span class="ruby-identifier">label</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:label</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">true</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sect</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">all_sections</span> = <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">all_sections</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">destination</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">all_sections</span> = [<span class="ruby-identifier">sect</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">counter</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">all_sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>

    <span class="ruby-identifier">moved_items</span> = []
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
        <span class="ruby-identifier">time_string</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
        <span class="ruby-identifier">time_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; 12am&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_string</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/(\d+:\d+|\d+[ap])/</span>
        <span class="ruby-identifier">cutoff</span> = <span class="ruby-identifier">chronify</span>(<span class="ruby-identifier">time_string</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> ((<span class="ruby-operator">!</span><span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">bool</span>)) <span class="ruby-operator">||</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">to_s</span>)) <span class="ruby-operator">||</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">cutoff</span>))
          <span class="ruby-identifier">moved_items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">item</span>)
          <span class="ruby-identifier">counter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">moved_items</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">label</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@current_section</span>
          <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] =
            <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/(?:@from\(.*?\))?(.*)$/</span>, <span class="ruby-node">&quot;\\1 @from(#{section})&quot;</span>)
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">items</span>
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">destination</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">moved_items</span>)
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Archived #{moved_items.length} items from #{section} to #{destination}&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">count</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">count</span>

      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">label</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">!=</span> <span class="ruby-ivar">@current_section</span>
          <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] =
            <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/(?:@from\(.*?\))?(.*)$/</span>, <span class="ruby-node">&quot;\\1 @from(#{section})&quot;</span>)
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">item</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>
        <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">destination</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">items</span>[<span class="ruby-identifier">count</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
      <span class="ruby-keyword">else</span>
        <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">destination</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">items</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span>
                                     []
                                   <span class="ruby-keyword">else</span>
                                     <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
                                   <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Archived #{items.length - count} items from #{section} to #{destination}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-edit_last" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">edit_last</span><span
            class="method-args">(section: &#39;All&#39;, options: {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Edit the last entry</p>

<p>@param section (String) The section, default “All”</p>

          <div class="method-source-code" id="edit_last-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1332</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">edit_last</span>(<span class="ruby-value">section:</span> <span class="ruby-string">&#39;All&#39;</span>, <span class="ruby-value">options:</span> {})
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">items</span> = []
    <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>])
    <span class="ruby-keyword">end</span>
    <span class="ruby-comment"># section = combined[&#39;items&#39;].dup.sort_by { |item| item[&#39;date&#39;] }.reverse[0][&#39;section&#39;]</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">items</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>

  <span class="ruby-identifier">idx</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>], <span class="ruby-identifier">options</span>[<span class="ruby-value">:tag_bool</span>])
        <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">i</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:search</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">options</span>[<span class="ruby-value">:search</span>])
        <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">i</span>
        <span class="ruby-keyword">break</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">idx</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;No entries found&#39;</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">items</span>[<span class="ruby-identifier">idx</span>][<span class="ruby-string">&#39;section&#39;</span>]

  <span class="ruby-identifier">section_items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-identifier">s_idx</span> = <span class="ruby-identifier">section_items</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">items</span>[<span class="ruby-identifier">idx</span>])

  <span class="ruby-identifier">current_item</span> = <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;title&#39;</span>]
  <span class="ruby-identifier">old_note</span> = <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;note&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;note&#39;</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">current_item</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\n#{old_note}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">old_note</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">new_item</span> = <span class="ruby-identifier">fork_editor</span>(<span class="ruby-identifier">current_item</span>)
  <span class="ruby-identifier">title</span>, <span class="ruby-identifier">note</span> = <span class="ruby-identifier">format_input</span>(<span class="ruby-identifier">new_item</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;No content provided&#39;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">note</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">old_note</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;No change in content&#39;</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
    <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>][<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">note</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Entry edited: #{section_items[s_idx][&#39;title&#39;]}&quot;</span>)
    <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">section_items</span>
    <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-exec_available" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">exec_available</span><span
            class="method-args">(cli)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Test if command line tool is available</p>

<p>@param cli The cli</p>

          <div class="method-source-code" id="exec_available-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2433</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">exec_available</span>(<span class="ruby-identifier">cli</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">cli</span>))
    <span class="ruby-constant">File</span>.<span class="ruby-identifier">executable?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">cli</span>))
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">system</span> <span class="ruby-node">&quot;which #{cli}&quot;</span>, <span class="ruby-value">out:</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NULL</span>, <span class="ruby-value">err:</span> <span class="ruby-constant">File</span><span class="ruby-operator">::</span><span class="ruby-constant">NULL</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-find_local_config" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">find_local_config</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Finds a project-specific configuration file</p>

<p>@return (String) A file path</p>

          <div class="method-source-code" id="find_local_config-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 37</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">find_local_config</span>
  <span class="ruby-identifier">dir</span> = <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>

  <span class="ruby-identifier">local_config_files</span> = []

  <span class="ruby-keyword">while</span> <span class="ruby-identifier">dir</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;/&#39;</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">dir</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">%r{[A-Z]:/}</span>).<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">local_config_files</span>.<span class="ruby-identifier">push</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@default_config_file</span>)) <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">dir</span>, <span class="ruby-ivar">@default_config_file</span>)

    <span class="ruby-identifier">dir</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-identifier">dir</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">local_config_files</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-fmt_time" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">fmt_time</span><span
            class="method-args">(seconds)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Format human readable time from seconds</p>

<p>@param seconds The seconds</p>

          <div class="method-source-code" id="fmt_time-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2411</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fmt_time</span>(<span class="ruby-identifier">seconds</span>)
  <span class="ruby-keyword">return</span> [<span class="ruby-value">0</span>, <span class="ruby-value">0</span>, <span class="ruby-value">0</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">seconds</span>.<span class="ruby-identifier">class</span> <span class="ruby-operator">==</span> <span class="ruby-constant">String</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">seconds</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/(\d+):(\d+):(\d+)/</span>
    <span class="ruby-identifier">h</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>)
    <span class="ruby-identifier">m</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>)
    <span class="ruby-identifier">s</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">3</span>)
    <span class="ruby-identifier">seconds</span> = (<span class="ruby-identifier">h</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>) <span class="ruby-operator">+</span> (<span class="ruby-identifier">m</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span>) <span class="ruby-operator">+</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">to_i</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">minutes</span> = (<span class="ruby-identifier">seconds</span> <span class="ruby-operator">/</span> <span class="ruby-value">60</span>).<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">hours</span> = (<span class="ruby-identifier">minutes</span> <span class="ruby-operator">/</span> <span class="ruby-value">60</span>).<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">days</span> = (<span class="ruby-identifier">hours</span> <span class="ruby-operator">/</span> <span class="ruby-value">24</span>).<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">hours</span> = (<span class="ruby-identifier">hours</span> <span class="ruby-operator">%</span> <span class="ruby-value">24</span>).<span class="ruby-identifier">to_i</span>
  <span class="ruby-identifier">minutes</span> = (<span class="ruby-identifier">minutes</span> <span class="ruby-operator">%</span> <span class="ruby-value">60</span>).<span class="ruby-identifier">to_i</span>
  [<span class="ruby-identifier">days</span>, <span class="ruby-identifier">hours</span>, <span class="ruby-identifier">minutes</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-fork_editor" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">fork_editor</span><span
            class="method-args">(input = &#39;&#39;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Create a process for an editor and wait for the file handle to return</p>

<p>@param input (String) Text input for editor</p>

          <div class="method-source-code" id="fork_editor-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 273</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">fork_editor</span>(<span class="ruby-identifier">input</span> = <span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-identifier">tmpfile</span> = <span class="ruby-constant">Tempfile</span>.<span class="ruby-identifier">new</span>([<span class="ruby-string">&#39;doing&#39;</span>, <span class="ruby-string">&#39;.md&#39;</span>])

  <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span>, <span class="ruby-string">&#39;w+&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">input</span>
    <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;\n# The first line is the entry title, any lines after that are added as a note&quot;</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">pid</span> = <span class="ruby-constant">Process</span>.<span class="ruby-identifier">fork</span> { <span class="ruby-identifier">system</span>(<span class="ruby-node">&quot;$EDITOR #{tmpfile.path}&quot;</span>) }

  <span class="ruby-identifier">trap</span>(<span class="ruby-string">&#39;INT&#39;</span>) <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">begin</span>
      <span class="ruby-constant">Process</span>.<span class="ruby-identifier">kill</span>(<span class="ruby-value">9</span>, <span class="ruby-identifier">pid</span>)
    <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
      <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ESRCH</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">unlink</span>
    <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">close!</span>
    <span class="ruby-identifier">exit</span> <span class="ruby-value">0</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-constant">Process</span>.<span class="ruby-identifier">wait</span>(<span class="ruby-identifier">pid</span>)

  <span class="ruby-keyword">begin</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">$?</span>.<span class="ruby-identifier">exitstatus</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>
      <span class="ruby-identifier">input</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">path</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;Cancelled&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">ensure</span>
    <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">close</span>
    <span class="ruby-identifier">tmpfile</span>.<span class="ruby-identifier">unlink</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">input</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n/</span>).<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#/</span> }.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-format_input" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">format_input</span><span
            class="method-args">(input)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Takes a multi-line string and formats it as an entry</p>

<p>@return (Array) [(String)title, (Array)note]</p>

<p>@param input (String) The string to parse</p>

          <div class="method-source-code" id="format_input-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 317</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">format_input</span>(<span class="ruby-identifier">input</span>)
  <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;No content in entry&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">input_lines</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/[\n\r]+/</span>).<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*$/</span> }
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">input_lines</span>[<span class="ruby-value">0</span>]&amp;.<span class="ruby-identifier">strip</span>
  <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;No content in first line&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>

  <span class="ruby-identifier">note</span> = <span class="ruby-identifier">input_lines</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">input_lines</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-operator">:</span> []
  <span class="ruby-comment"># If title line ends in a parenthetical, use that as the note</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/\s+\(.*?\)$/</span>
    <span class="ruby-identifier">title</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/\s+\((.*?)\)$/</span>) <span class="ruby-keyword">do</span>
      <span class="ruby-identifier">m</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>
      <span class="ruby-identifier">note</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">m</span>[<span class="ruby-value">1</span>])
      <span class="ruby-string">&#39;&#39;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">note</span>.<span class="ruby-identifier">map!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>)
  <span class="ruby-identifier">note</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*$/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#/</span> }

  [<span class="ruby-identifier">title</span>, <span class="ruby-identifier">note</span>]
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get_end_date" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_end_date</span><span
            class="method-args">(item)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Gets the entry finish date from the @done  tag</p>

<p>@param item (Hash) The entry</p>

<p>@return (Date) finish date or nil if empty</p>

          <div class="method-source-code" id="get_end_date-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2335</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_end_date</span>(<span class="ruby-identifier">item</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@done\((\d{4}-\d\d-\d\d \d\d:\d\d.*?)\)/</span>

  <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get_interval" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_interval</span><span
            class="method-args">(item, formatted: true, record: true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Gets the interval between entry&#39;s start  date and @done date</p>

<p>@param item (Hash) The entry @param formatted (Bool) Return human readable  time (default seconds) @param record (Bool) Add the interval to the  total for each tag</p>

<p>@return Interval in seconds, or [d, h, m] array if  formatted is true. False if no end date or  interval is 0</p>

          <div class="method-source-code" id="get_interval-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2355</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_interval</span>(<span class="ruby-identifier">item</span>, <span class="ruby-value">formatted:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">done</span> = <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">start</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@interval_cache</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">include?</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]
    <span class="ruby-identifier">seconds</span> = <span class="ruby-ivar">@interval_cache</span>[<span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]]
    <span class="ruby-identifier">record_tag_times</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">seconds</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">record</span>
    <span class="ruby-keyword">return</span> <span class="ruby-identifier">seconds</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;%02d:%02d:%02d&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fmt_time</span>(<span class="ruby-identifier">seconds</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">done</span> = <span class="ruby-identifier">get_end_date</span>(<span class="ruby-identifier">item</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">done</span>.<span class="ruby-identifier">nil?</span>

  <span class="ruby-identifier">start</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@start\((\d{4}-\d\d-\d\d \d\d:\d\d.*?)\)/</span>
            <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>))
          <span class="ruby-keyword">else</span>
            <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>]
          <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">seconds</span> = (<span class="ruby-identifier">done</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">start</span>).<span class="ruby-identifier">to_i</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">record</span>
    <span class="ruby-identifier">record_tag_times</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">seconds</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@interval_cache</span>[<span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]] = <span class="ruby-identifier">seconds</span>

  <span class="ruby-keyword">return</span> <span class="ruby-identifier">seconds</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">seconds</span> <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">formatted</span>

  <span class="ruby-identifier">seconds</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;%02d:%02d:%02d&#39;</span> <span class="ruby-operator">%</span> <span class="ruby-identifier">fmt_time</span>(<span class="ruby-identifier">seconds</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-get_view" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">get_view</span><span
            class="method-args">(title)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Gets a view from configuration</p>

<p>@param title (String) The title of the view to retrieve</p>

          <div class="method-source-code" id="get_view-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1665</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">get_view</span>(<span class="ruby-identifier">title</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;views&#39;</span>][<span class="ruby-identifier">title</span>] <span class="ruby-keyword">if</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;views&#39;</span>].<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">title</span>)

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-guess_section" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">guess_section</span><span
            class="method-args">(frag, guessed: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Attempt to match a string with an existing section</p>

<p>@param frag (String) The user-provided string @param guessed (Boolean) already guessed and failed</p>

          <div class="method-source-code" id="guess_section-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 430</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">guess_section</span>(<span class="ruby-identifier">frag</span>, <span class="ruby-value">guessed:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;All&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frag</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
  <span class="ruby-identifier">frag</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@current_section</span>
  <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">cap_first</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frag</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">downcase</span> }
  <span class="ruby-identifier">section</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">re</span> = <span class="ruby-identifier">frag</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.*?&#39;</span>)
  <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">sect</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">sect</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/#{re}/i</span>

    <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Assuming you meant #{sect}&quot;</span>
    <span class="ruby-identifier">section</span> = <span class="ruby-identifier">sect</span>
    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">guessed</span>
    <span class="ruby-identifier">alt</span> = <span class="ruby-identifier">guess_view</span>(<span class="ruby-identifier">frag</span>, <span class="ruby-keyword">true</span>)
    <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Did you mean `doing view #{alt}`?&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">alt</span>

    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">yn</span>(<span class="ruby-node">&quot;Section #{frag} not found, create it&quot;</span>, <span class="ruby-value">default_response:</span> <span class="ruby-keyword">false</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>
      <span class="ruby-identifier">add_section</span>(<span class="ruby-identifier">frag</span>.<span class="ruby-identifier">cap_first</span>)
      <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">frag</span>.<span class="ruby-identifier">cap_first</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Unknown section: #{frag}&quot;</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">section</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">section</span>.<span class="ruby-identifier">cap_first</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">guessed</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-guess_view" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">guess_view</span><span
            class="method-args">(frag, guessed = false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Attempt to match a string with an existing view</p>

<p>@param frag (String) The user-provided string @param guessed (Boolean) already guessed</p>

          <div class="method-source-code" id="guess_view-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 511</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">guess_view</span>(<span class="ruby-identifier">frag</span>, <span class="ruby-identifier">guessed</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">views</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">view</span><span class="ruby-operator">|</span> <span class="ruby-keyword">return</span> <span class="ruby-identifier">view</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">frag</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">view</span>.<span class="ruby-identifier">downcase</span> }
  <span class="ruby-identifier">view</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">re</span> = <span class="ruby-identifier">frag</span>.<span class="ruby-identifier">split</span>(<span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;.*?&#39;</span>)
  <span class="ruby-identifier">views</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/#{re}/i</span>

    <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Assuming you meant #{v}&quot;</span>
    <span class="ruby-identifier">view</span> = <span class="ruby-identifier">v</span>
    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">view</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">guessed</span>
    <span class="ruby-identifier">alt</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">frag</span>, <span class="ruby-value">guessed:</span> <span class="ruby-keyword">true</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">alt</span>
      <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Did you mean `doing show #{alt}`?&quot;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Unknown view: #{frag}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">view</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-import" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">import</span><span
            class="method-args">(paths, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Imports external entries</p>

<p>@param path (String) Path to JSON report file @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="import-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 629</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">import</span>(<span class="ruby-identifier">paths</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">plugins</span>[<span class="ruby-value">:import</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:type</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(#{options[:trigger]})$/i</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">count</span>.<span class="ruby-identifier">positive?</span>
      <span class="ruby-identifier">paths</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">path</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">options</span>[<span class="ruby-value">:class</span>].<span class="ruby-identifier">import</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">path</span>, <span class="ruby-value">options:</span> <span class="ruby-identifier">opt</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:class</span>].<span class="ruby-identifier">import</span>(<span class="ruby-keyword">self</span>, <span class="ruby-keyword">nil</span>, <span class="ruby-value">options:</span> <span class="ruby-identifier">opt</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-init_doing_file" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">init_doing_file</span><span
            class="method-args">(path = nil)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Initializes the doing file.</p>

<p>@param path (String) Override path to a doing file, optional</p>

          <div class="method-source-code" id="init_doing_file-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 201</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">init_doing_file</span>(<span class="ruby-identifier">path</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-ivar">@doing_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;doing_file&#39;</span>])

  <span class="ruby-identifier">input</span> = <span class="ruby-identifier">path</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">create</span>(<span class="ruby-ivar">@doing_file</span>) <span class="ruby-keyword">unless</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@doing_file</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-ivar">@doing_file</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;utf-8&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:force_encoding</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">file?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">stat</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>)).<span class="ruby-identifier">size</span>.<span class="ruby-identifier">positive?</span>
    <span class="ruby-ivar">@doing_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>))
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;utf-8&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:force_encoding</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">256</span>
    <span class="ruby-ivar">@doing_file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>)
    <span class="ruby-identifier">create</span>(<span class="ruby-identifier">input</span>)
    <span class="ruby-identifier">input</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">read</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">input</span>))
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">force_encoding</span>(<span class="ruby-string">&#39;utf-8&#39;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">input</span>.<span class="ruby-identifier">respond_to?</span> <span class="ruby-value">:force_encoding</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@other_content_top</span> = []
  <span class="ruby-ivar">@other_content_bottom</span> = []

  <span class="ruby-identifier">section</span> = <span class="ruby-string">&#39;Uncategorized&#39;</span>
  <span class="ruby-identifier">lines</span> = <span class="ruby-identifier">input</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/[\n\r]/</span>)
  <span class="ruby-identifier">current</span> = <span class="ruby-value">0</span>

  <span class="ruby-identifier">lines</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*$/</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(\S[\S ]+):\s*(@\S+\s*)*$/</span>
      <span class="ruby-identifier">section</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>)
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>] = {}
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;original&#39;</span>] = <span class="ruby-identifier">line</span>
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = []
      <span class="ruby-identifier">current</span> = <span class="ruby-value">0</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*- (\d{4}-\d\d-\d\d \d\d:\d\d) \| (.*)/</span>
      <span class="ruby-identifier">date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">1</span>))
      <span class="ruby-identifier">title</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">last_match</span>(<span class="ruby-value">2</span>)
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">push</span>({ <span class="ruby-string">&#39;title&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">title</span>, <span class="ruby-string">&#39;date&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">date</span>, <span class="ruby-string">&#39;section&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">section</span> })
      <span class="ruby-identifier">current</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current</span>.<span class="ruby-identifier">zero?</span>
      <span class="ruby-comment"># if content[section][&#39;items&#39;].length - 1 == current</span>
      <span class="ruby-ivar">@other_content_top</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\S/</span>
      <span class="ruby-ivar">@other_content_bottom</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">current</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>][<span class="ruby-string">&#39;note&#39;</span>] = [] <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">current</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">key?</span> <span class="ruby-string">&#39;note&#39;</span>

      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">current</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>][<span class="ruby-string">&#39;note&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">line</span>.<span class="ruby-identifier">chomp</span>)
      <span class="ruby-comment"># end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-interactive" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">interactive</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Display an interactive menu of entries</p>

<p>@param opt (Hash) Additional options</p>

          <div class="method-source-code" id="interactive-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 761</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">interactive</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">fzf</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-keyword">__FILE__</span>), <span class="ruby-string">&#39;../helpers/fuzzyfilefinder&#39;</span>)

  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]) <span class="ruby-operator">:</span> <span class="ruby-string">&#39;All&#39;</span>


  <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
    <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-keyword">end</span>


  <span class="ruby-identifier">options</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">map</span>.<span class="ruby-identifier">with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">out</span> = [
      <span class="ruby-identifier">i</span>,
      <span class="ruby-string">&#39;) &#39;</span>,
      <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>],
      <span class="ruby-string">&#39; | &#39;</span>,
      <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]
    ]
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all/i</span>
      <span class="ruby-identifier">out</span>.<span class="ruby-identifier">concat</span>([
        <span class="ruby-string">&#39; (&#39;</span>,
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;section&#39;</span>],
        <span class="ruby-string">&#39;) &#39;</span>
      ])
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">out</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;&#39;</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">fzf_args</span> = [
    <span class="ruby-string">%(--header=&quot;Arrows: navigate, tab: mark for selection, ctrl-a: select all, enter: commit&quot;)</span>,
    <span class="ruby-string">%(--prompt=&quot;Select entries to act on &gt; &quot;)</span>,
    <span class="ruby-string">&#39;-1&#39;</span>,
    <span class="ruby-string">&#39;-m&#39;</span>,
    <span class="ruby-string">&#39;--bind ctrl-a:select-all&#39;</span>,
    <span class="ruby-node">%(-q &quot;#{opt[:query]}&quot;)</span>
  ]
  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opt</span>[<span class="ruby-value">:menu</span>]
    <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&quot;Can&#39;t skip menu when no query is provided&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:query</span>]

    <span class="ruby-identifier">fzf_args</span>.<span class="ruby-identifier">concat</span>([<span class="ruby-node">%(--filter=&quot;#{opt[:query]}&quot;)</span>, <span class="ruby-string">&#39;--no-sort&#39;</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">res</span> = <span class="ruby-node">`echo #{Shellwords.escape(options.join(&quot;\n&quot;))}|#{fzf} #{fzf_args.join(&#39; &#39;)}`</span>
  <span class="ruby-identifier">selected</span> = []
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^(\d+)\)/</span>)[<span class="ruby-value">1</span>].<span class="ruby-identifier">to_i</span>
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">items</span>[<span class="ruby-identifier">idx</span>])
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&quot;No selection&quot;</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">actions</span> = <span class="ruby-node">%i[editor delete tag flag finish cancel tag archive output save_to]</span>
  <span class="ruby-identifier">has_action</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">actions</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">a</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-identifier">a</span>]
      <span class="ruby-identifier">has_action</span> = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">break</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">has_action</span>
    <span class="ruby-identifier">choice</span> = <span class="ruby-identifier">choose_from</span>([
                           <span class="ruby-string">&#39;add tag&#39;</span>,
                           <span class="ruby-string">&#39;remove tag&#39;</span>,
                           <span class="ruby-string">&#39;cancel&#39;</span>,
                           <span class="ruby-string">&#39;delete&#39;</span>,
                           <span class="ruby-string">&#39;finish&#39;</span>,
                           <span class="ruby-string">&#39;flag&#39;</span>,
                           <span class="ruby-string">&#39;archive&#39;</span>,
                           <span class="ruby-string">&#39;move&#39;</span>,
                           <span class="ruby-string">&#39;edit&#39;</span>,
                           <span class="ruby-string">&#39;output formatted&#39;</span>
                         ],
                         <span class="ruby-value">prompt:</span> <span class="ruby-string">&#39;What do you want to do with the selected items? &gt; &#39;</span>,
                         <span class="ruby-value">multiple:</span> <span class="ruby-keyword">true</span>,
                         <span class="ruby-value">fzf_args:</span> [<span class="ruby-string">&#39;--height=60%&#39;</span>, <span class="ruby-string">&#39;--tac&#39;</span>, <span class="ruby-string">&#39;--no-sort&#39;</span>])
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">choice</span>

    <span class="ruby-identifier">to_do</span> = <span class="ruby-identifier">choice</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/\n/</span>)
    <span class="ruby-identifier">to_do</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">action</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">action</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/(add|remove) tag/</span>
        <span class="ruby-identifier">type</span> = <span class="ruby-identifier">action</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^add/</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;add&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;remove&#39;</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
          <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&quot;&#39;add tag&#39; and &#39;remove tag&#39; can not be used together&quot;</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">print</span> <span class="ruby-node">&quot;#{colors[&#39;yellow&#39;]}Tag to #{type}: #{colors[&#39;reset&#39;]}&quot;</span>
        <span class="ruby-identifier">tag</span> = <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">gets</span>
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^ *$/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>] = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^@/</span>, <span class="ruby-string">&#39;&#39;</span>)
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>] = <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">type</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;remove&#39;</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/output formatted/</span>
        <span class="ruby-identifier">output_format</span> = <span class="ruby-identifier">choose_from</span>(<span class="ruby-node">%w[doing taskpaper json timeline html csv]</span>.<span class="ruby-identifier">sort</span>, <span class="ruby-value">prompt:</span> <span class="ruby-string">&#39;Which output format? &gt; &#39;</span>, <span class="ruby-value">fzf_args:</span> [<span class="ruby-string">&#39;--height=60%&#39;</span>, <span class="ruby-string">&#39;--tac&#39;</span>, <span class="ruby-string">&#39;--no-sort&#39;</span>])
        <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^ *$/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>] = <span class="ruby-identifier">output_format</span>.<span class="ruby-identifier">strip</span>
        <span class="ruby-identifier">res</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:force</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword">false</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">yn</span>(<span class="ruby-string">&#39;Save to file?&#39;</span>, <span class="ruby-value">default_response:</span> <span class="ruby-string">&#39;n&#39;</span>)
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>
          <span class="ruby-identifier">print</span> <span class="ruby-node">&quot;#{colors[&#39;yellow&#39;]}File path/name: #{colors[&#39;reset&#39;]}&quot;</span>
          <span class="ruby-identifier">filename</span> = <span class="ruby-constant">STDIN</span>.<span class="ruby-identifier">gets</span>.<span class="ruby-identifier">strip</span>
          <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">filename</span>.<span class="ruby-identifier">empty?</span>
          <span class="ruby-identifier">opt</span>[<span class="ruby-value">:save_to</span>] = <span class="ruby-identifier">filename</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/archive/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/delete/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:delete</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/edit/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:editor</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/finish/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:finish</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/cancel/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:cancel</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/move/</span>
        <span class="ruby-identifier">section</span> = <span class="ruby-identifier">choose_section</span>.<span class="ruby-identifier">strip</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:move</span>] = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">strip</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^ *$/</span>
      <span class="ruby-keyword">when</span> <span class="ruby-regexp">/flag/</span>
        <span class="ruby-identifier">opt</span>[<span class="ruby-value">:flag</span>] = <span class="ruby-keyword">true</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:delete</span>]
    <span class="ruby-identifier">res</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:force</span>] <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">yn</span>(<span class="ruby-node">&quot;Delete #{selected.size} items?&quot;</span>, <span class="ruby-value">default_response:</span> <span class="ruby-string">&#39;y&#39;</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span>
      <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">each</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">delete_item</span>(<span class="ruby-identifier">item</span>) }
      <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
    <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:flag</span>]
    <span class="ruby-identifier">tag</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;marker_tag&#39;</span>] <span class="ruby-operator">||</span> <span class="ruby-string">&#39;flagged&#39;</span>
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>]
        <span class="ruby-identifier">untag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">tag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-value">date:</span> <span class="ruby-keyword">false</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:finish</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:cancel</span>]
    <span class="ruby-identifier">tag</span> = <span class="ruby-string">&#39;done&#39;</span>
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>]
        <span class="ruby-identifier">untag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">tag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-value">date:</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opt</span>[<span class="ruby-value">:cancel</span>])
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
    <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>]
        <span class="ruby-identifier">untag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>)
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">tag_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">tag</span>, <span class="ruby-value">date:</span> <span class="ruby-keyword">false</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:move</span>]
    <span class="ruby-identifier">section</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">?</span> <span class="ruby-string">&#39;Archive&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:move</span>])
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">map!</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">move_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">section</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:editor</span>]

    <span class="ruby-identifier">editable_items</span> = []

    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">editable</span> = <span class="ruby-node">&quot;#{item[&#39;date&#39;]} | #{item[&#39;title&#39;]}&quot;</span>
      <span class="ruby-identifier">old_note</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;note&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;note&#39;</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
      <span class="ruby-identifier">editable</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\n#{old_note}&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">old_note</span>.<span class="ruby-identifier">nil?</span>
      <span class="ruby-identifier">editable_items</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">editable</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">divider</span> = <span class="ruby-string">&quot;\n-----------\n&quot;</span>
    <span class="ruby-identifier">input</span> = <span class="ruby-identifier">editable_items</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>).<span class="ruby-identifier">join</span>(<span class="ruby-identifier">divider</span>) <span class="ruby-operator">+</span> <span class="ruby-string">&quot;\n\n# You may delete entries, but leave all divider lines in place&quot;</span>

    <span class="ruby-identifier">new_items</span> = <span class="ruby-identifier">fork_editor</span>(<span class="ruby-identifier">input</span>).<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/#{divider}/</span>)

    <span class="ruby-identifier">new_items</span>.<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">new_item</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>

      <span class="ruby-identifier">input_lines</span> = <span class="ruby-identifier">new_item</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/[\n\r]+/</span>).<span class="ruby-identifier">delete_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*$/</span> }
      <span class="ruby-identifier">title</span> = <span class="ruby-identifier">input_lines</span>[<span class="ruby-value">0</span>]&amp;.<span class="ruby-identifier">strip</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#{divider.strip}$/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">title</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">empty?</span>
        <span class="ruby-identifier">delete_item</span>(<span class="ruby-identifier">selected</span>[<span class="ruby-identifier">i</span>])
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">note</span> = <span class="ruby-identifier">input_lines</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">input_lines</span>[<span class="ruby-value">1</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>] <span class="ruby-operator">:</span> []

        <span class="ruby-identifier">note</span>.<span class="ruby-identifier">map!</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>)
        <span class="ruby-identifier">note</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">line</span><span class="ruby-operator">|</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^\s*$/</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">line</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^#/</span> }

        <span class="ruby-identifier">date</span> = <span class="ruby-identifier">title</span>.<span class="ruby-identifier">match</span>(<span class="ruby-regexp">/^([\d\-: ]+) \| /</span>)[<span class="ruby-value">1</span>]
        <span class="ruby-identifier">title</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^([\d\-: ]+) \| /</span>, <span class="ruby-string">&#39;&#39;</span>)

        <span class="ruby-identifier">item</span> = <span class="ruby-identifier">selected</span>[<span class="ruby-identifier">i</span>].<span class="ruby-identifier">dup</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">note</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">date</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">selected</span>[<span class="ruby-identifier">i</span>][<span class="ruby-string">&#39;date&#39;</span>]
        <span class="ruby-identifier">update_item</span>(<span class="ruby-identifier">selected</span>[<span class="ruby-identifier">i</span>], <span class="ruby-identifier">item</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>]
    <span class="ruby-identifier">selected</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-node">&quot;#{item[&#39;title&#39;]} @project(#{item[&#39;section&#39;]})&quot;</span>
      <span class="ruby-identifier">item</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@content</span> = { <span class="ruby-string">&#39;Export&#39;</span> <span class="ruby-operator">=&gt;</span> { <span class="ruby-string">&#39;original&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-string">&#39;Export:&#39;</span>, <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">selected</span> } }
    <span class="ruby-identifier">options</span> = { <span class="ruby-value">section:</span> <span class="ruby-string">&#39;Export&#39;</span> }

    <span class="ruby-keyword">case</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>]
    <span class="ruby-keyword">when</span> <span class="ruby-regexp">/doing/</span>
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:template</span>] = <span class="ruby-string">&#39;- %date | %title%note&#39;</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">options</span>[<span class="ruby-value">:output</span>] = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>]
    <span class="ruby-keyword">end</span>

    <span class="ruby-identifier">output</span> = <span class="ruby-identifier">list_section</span>(<span class="ruby-identifier">options</span>)

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:save_to</span>]
      <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:save_to</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
        <span class="ruby-comment"># Create a backup copy for the undo command</span>
        <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">file</span>, <span class="ruby-node">&quot;#{file}~&quot;</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;w+&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">output</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Export saved to #{file}&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">puts</span> <span class="ruby-identifier">output</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-last" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">last</span><span
            class="method-args">(times: true, section: nil, options: {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Show the last entry</p>

<p>@param times (Bool) Show times @param section (String) Section to pull from, default Currently</p>

          <div class="method-source-code" id="last-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2135</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">last</span>(<span class="ruby-value">times:</span> <span class="ruby-keyword">true</span>, <span class="ruby-value">section:</span> <span class="ruby-keyword">nil</span>, <span class="ruby-value">options:</span> {})
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">section</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/all/i</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;All&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-identifier">cfg</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;last&#39;</span>]

  <span class="ruby-identifier">opts</span> = {
    <span class="ruby-value">section:</span> <span class="ruby-identifier">section</span>,
    <span class="ruby-value">wrap_width:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;wrap_width&#39;</span>],
    <span class="ruby-value">count:</span> <span class="ruby-value">1</span>,
    <span class="ruby-value">format:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;date_format&#39;</span>],
    <span class="ruby-value">template:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;template&#39;</span>],
    <span class="ruby-value">times:</span> <span class="ruby-identifier">times</span>
  }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>]
    <span class="ruby-identifier">opts</span>[<span class="ruby-value">:tag_filter</span>] = {
      <span class="ruby-string">&#39;tags&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:tag</span>],
      <span class="ruby-string">&#39;bool&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:tag_bool</span>]
    }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">opts</span>[<span class="ruby-value">:search</span>] = <span class="ruby-identifier">options</span>[<span class="ruby-value">:search</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:search</span>]

  <span class="ruby-identifier">list_section</span>(<span class="ruby-identifier">opts</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-last_entry" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">last_entry</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Get the last entry</p>

<p>@param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="last_entry-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 703</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">last_entry</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_bool</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">:and</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@current_section</span>

  <span class="ruby-identifier">sec_arr</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">sec_arr</span> = [<span class="ruby-ivar">@current_section</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
      <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
      <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">items</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>
      <span class="ruby-identifier">sec_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;section&#39;</span>])
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sec_arr</span> = [<span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>])]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">all_items</span> = []
  <span class="ruby-identifier">sec_arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">all_items</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]&amp;.<span class="ruby-identifier">length</span>
    <span class="ruby-identifier">all_items</span>.<span class="ruby-identifier">select!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>], <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_bool</span>]) }
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>]&amp;.<span class="ruby-identifier">length</span>
    <span class="ruby-identifier">all_items</span>.<span class="ruby-identifier">select!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>]) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">all_items</span>.<span class="ruby-identifier">max_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-last_note" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">last_note</span><span
            class="method-args">(section = &#39;All&#39;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Return the content of the last note for a given section</p>

<p>@param section (String) The section to retrieve from, default  All</p>

          <div class="method-source-code" id="last_note-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 650</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">last_note</span>(<span class="ruby-identifier">section</span> = <span class="ruby-string">&#39;All&#39;</span>)
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
    <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">section</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;section&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Section #{section} not found&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-identifier">last_item</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>[<span class="ruby-value">0</span>]
  <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Editing note for #{last_item[&#39;title&#39;]}&quot;</span>
  <span class="ruby-identifier">note</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">note</span> = <span class="ruby-identifier">last_item</span>[<span class="ruby-string">&#39;note&#39;</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>).<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">last_item</span>[<span class="ruby-string">&#39;note&#39;</span>].<span class="ruby-identifier">nil?</span>
  <span class="ruby-node">&quot;#{last_item[&#39;title&#39;]}\n# EDIT BELOW THIS LINE ------------\n#{note}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-list_date" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_date</span><span
            class="method-args">(dates, section, times = nil, output = nil, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Display entries within a date range</p>

<p>@param dates (Array) [start, end] @param section (String) The section @param times (Bool) Show times @param output (String) Output format @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="list_date-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2063</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_date</span>(<span class="ruby-identifier">dates</span>, <span class="ruby-identifier">section</span>, <span class="ruby-identifier">times</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">output</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-comment"># :date_filter expects an array with start and end date</span>
  <span class="ruby-identifier">dates</span> = [<span class="ruby-identifier">dates</span>, <span class="ruby-identifier">dates</span>] <span class="ruby-keyword">if</span> <span class="ruby-identifier">dates</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>)

  <span class="ruby-identifier">list_section</span>({ <span class="ruby-value">section:</span> <span class="ruby-identifier">section</span>, <span class="ruby-value">count:</span> <span class="ruby-value">0</span>, <span class="ruby-value">order:</span> <span class="ruby-string">&#39;asc&#39;</span>, <span class="ruby-value">date_filter:</span> <span class="ruby-identifier">dates</span>, <span class="ruby-value">times:</span> <span class="ruby-identifier">times</span>,
                 <span class="ruby-value">output:</span> <span class="ruby-identifier">output</span>, <span class="ruby-value">totals:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>], <span class="ruby-value">sort_tags:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] })
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-list_section" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">list_section</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Overachieving function for displaying contents of a section.  This is a fucking mess. I mean, Jesus Christ.</p>

<p>@param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="list_section-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1677</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">list_section</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">count</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:age</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;newest&#39;</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date_filter</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:format</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_date_format</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:only_timed</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;desc&#39;</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_order</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;asc&#39;</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tags_color</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:template</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@default_template</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:times</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:today</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-comment"># opt[:highlight] ||= true</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-string">&#39;&#39;</span>
  <span class="ruby-identifier">is_single</span> = <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">section</span> = <span class="ruby-identifier">choose_section</span>
    <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>]
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
      <span class="ruby-identifier">is_single</span> = <span class="ruby-keyword">false</span>
      <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
      <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
        <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">section</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>][<span class="ruby-string">&#39;bool&#39;</span>].<span class="ruby-identifier">normalize_bool</span> <span class="ruby-operator">!=</span> <span class="ruby-value">:not</span>
                  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>][<span class="ruby-string">&#39;tags&#39;</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
                    <span class="ruby-node">&quot;@#{tag}&quot;</span>
                  <span class="ruby-keyword">end</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; + &#39;</span>)
                <span class="ruby-keyword">else</span>
                  <span class="ruby-string">&#39;doing&#39;</span>
                <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] = <span class="ruby-identifier">combined</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>])
      <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;Invalid section object&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">instance_of?</span> <span class="ruby-constant">Hash</span>

  <span class="ruby-identifier">items</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date_filter</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">==</span> <span class="ruby-value">2</span>
    <span class="ruby-identifier">start_date</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date_filter</span>][<span class="ruby-value">0</span>]
    <span class="ruby-identifier">end_date</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date_filter</span>][<span class="ruby-value">1</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">keep_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">end_date</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">start_date</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">end_date</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>].<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%F&#39;</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">start_date</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%F&#39;</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>][<span class="ruby-string">&#39;tags&#39;</span>].<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">select!</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>][<span class="ruby-string">&#39;tags&#39;</span>], <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_filter</span>][<span class="ruby-string">&#39;bool&#39;</span>]) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">keep_if</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>]) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:only_timed</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">get_interval</span>(<span class="ruby-identifier">item</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">false</span>) <span class="ruby-operator">==</span> <span class="ruby-keyword">false</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
    <span class="ruby-identifier">time_string</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
    <span class="ruby-identifier">time_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; 12am&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_string</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/(\d+:\d+|\d+[ap])/</span>
    <span class="ruby-identifier">cutoff</span> = <span class="ruby-identifier">chronify</span>(<span class="ruby-identifier">time_string</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cutoff</span>
      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">cutoff</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>]
    <span class="ruby-identifier">time_string</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>]
    <span class="ruby-identifier">time_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; 11:59pm&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_string</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/(\d+:\d+|\d+[ap])/</span>
    <span class="ruby-identifier">cutoff</span> = <span class="ruby-identifier">chronify</span>(<span class="ruby-identifier">time_string</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">cutoff</span>
      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">cutoff</span> }
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:today</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">reverse!</span>
    <span class="ruby-identifier">section</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>.<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%A, %B %d&#39;</span>)
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:yesterday</span>]
    <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">prev_day</span>.<span class="ruby-identifier">to_time</span> <span class="ruby-keyword">or</span>
        <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&gt;=</span> <span class="ruby-constant">Date</span>.<span class="ruby-identifier">today</span>.<span class="ruby-identifier">to_time</span>
    <span class="ruby-keyword">end</span>.<span class="ruby-identifier">reverse!</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:age</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/oldest/i</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">count</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">reverse</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">count</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">items</span>.<span class="ruby-identifier">reverse!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:order</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^a/i</span>

  <span class="ruby-identifier">out</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>] = <span class="ruby-string">&#39;template&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>]

  <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;Unknown output format&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>] <span class="ruby-operator">=~</span> <span class="ruby-identifier">plugin_regex</span>(<span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)

  <span class="ruby-comment"># exporter = WWIDExport.new(section, items, is_single, opt, self)</span>
  <span class="ruby-identifier">export_options</span> = { <span class="ruby-value">page_title:</span> <span class="ruby-identifier">section</span>, <span class="ruby-value">is_single:</span> <span class="ruby-identifier">is_single</span>, <span class="ruby-value">options:</span> <span class="ruby-identifier">opt</span> }

  <span class="ruby-identifier">plugins</span>[<span class="ruby-value">:export</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:output</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(#{options[:trigger]})$/i</span>

    <span class="ruby-identifier">out</span> = <span class="ruby-identifier">options</span>[<span class="ruby-value">:class</span>].<span class="ruby-identifier">render</span>(<span class="ruby-keyword">self</span>, <span class="ruby-identifier">items</span>, <span class="ruby-value">variables:</span> <span class="ruby-identifier">export_options</span>)
    <span class="ruby-keyword">break</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">out</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-load_plugins" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">load_plugins</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="load_plugins-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1812</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">load_plugins</span>
  <span class="ruby-identifier">add_dir</span> = <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;plugin_path&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;plugin_path&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>

  <span class="ruby-constant">Doing</span><span class="ruby-operator">::</span><span class="ruby-constant">Plugins</span>.<span class="ruby-identifier">load_plugins</span>(<span class="ruby-identifier">add_dir</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-move_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">move_item</span><span
            class="method-args">(item, section)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Move item from current section to  destination section</p>

<p>@param item The item @param section The destination section</p>

<p>@return Updated item</p>

          <div class="method-source-code" id="move_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1198</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">move_item</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">section</span>)
  <span class="ruby-identifier">old_section</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;section&#39;</span>]
  <span class="ruby-identifier">new_item</span> = <span class="ruby-identifier">item</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">new_item</span>[<span class="ruby-string">&#39;section&#39;</span>] = <span class="ruby-identifier">section</span>

  <span class="ruby-identifier">section_items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">old_section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-identifier">section_items</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">item</span>)
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">old_section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">section_items</span>

  <span class="ruby-identifier">archive_items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-identifier">archive_items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">new_item</span>)
  <span class="ruby-comment"># archive_items = archive_items.sort_by { |item| item[&#39;date&#39;] }</span>
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">archive_items</span>

  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Entry moved to #{section}: #{new_item[&#39;title&#39;]}&quot;</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_item</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-next_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">next_item</span><span
            class="method-args">(old_item)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Get next item in the index</p>

<p>@param old_item</p>

          <div class="method-source-code" id="next_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1221</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">next_item</span>(<span class="ruby-identifier">old_item</span>)
  <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
  <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">items</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>
  <span class="ruby-identifier">idx</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">old_item</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">idx</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
    <span class="ruby-identifier">items</span>[<span class="ruby-identifier">idx</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-note_last" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">note_last</span><span
            class="method-args">(section, note, replace: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Add a note to the last entry in a section</p>

<p>@param section (String) The section, default “All” @param note (String) The note to add @param replace (Bool) Should replace existing note</p>

          <div class="method-source-code" id="note_last-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1403</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">note_last</span>(<span class="ruby-identifier">section</span>, <span class="ruby-identifier">note</span>, <span class="ruby-value">replace:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
    <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
    <span class="ruby-keyword">end</span>
    <span class="ruby-identifier">section</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;section&#39;</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Section #{section} not found&quot;</span> <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-comment"># sort_section(opt[:section])</span>
  <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>

  <span class="ruby-identifier">current_note</span> = <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;note&#39;</span>]
  <span class="ruby-identifier">current_note</span> = [] <span class="ruby-keyword">if</span> <span class="ruby-identifier">current_note</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;title&#39;</span>]
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">replace</span>
    <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">note</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_note</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Removed note from &quot;#{title}&quot;)</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">current_note</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Replaced note from &quot;#{title}&quot;)</span>)
    <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added note to &quot;#{title}&quot;)</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Entry &quot;#{title}&quot; has no note)</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">current_note</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">Array</span>)
    <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">current_note</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">note</span>)
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added note to &quot;#{title}&quot;)</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;note&#39;</span>] = <span class="ruby-identifier">note</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added note to &quot;#{title}&quot;)</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">note</span>.<span class="ruby-identifier">empty?</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">items</span>

<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-overlapping_time-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">overlapping_time?</span><span
            class="method-args">(item_a, item_b)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="overlapping_time-3F-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 593</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">overlapping_time?</span>(<span class="ruby-identifier">item_a</span>, <span class="ruby-identifier">item_b</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">same_time?</span>(<span class="ruby-identifier">item_a</span>, <span class="ruby-identifier">item_b</span>)

  <span class="ruby-identifier">start_a</span> = <span class="ruby-identifier">item_a</span>[<span class="ruby-string">&#39;date&#39;</span>]
  <span class="ruby-identifier">interval</span> = <span class="ruby-identifier">get_interval</span>(<span class="ruby-identifier">item_a</span>, <span class="ruby-value">formatted:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">end_a</span> = <span class="ruby-identifier">interval</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">start_a</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">interval</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">start_a</span>
  <span class="ruby-identifier">start_b</span> = <span class="ruby-identifier">item_b</span>[<span class="ruby-string">&#39;date&#39;</span>]
  <span class="ruby-identifier">interval</span> = <span class="ruby-identifier">get_interval</span>(<span class="ruby-identifier">item_b</span>,  <span class="ruby-value">formatted:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">end_b</span> = <span class="ruby-identifier">interval</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">start_b</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">interval</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">start_b</span>
  (<span class="ruby-identifier">start_a</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">start_b</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">start_a</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">end_b</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">end_a</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-identifier">start_b</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_a</span> <span class="ruby-operator">&lt;=</span> <span class="ruby-identifier">end_b</span>) <span class="ruby-operator">||</span> (<span class="ruby-identifier">start_a</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">start_b</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">end_a</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">end_b</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-plugin_names" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">plugin_names</span><span
            class="method-args">(type: :export)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="plugin_names-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1818</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">plugin_names</span>(<span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)
  <span class="ruby-identifier">plugins</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39;|&#39;</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-plugin_regex" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">plugin_regex</span><span
            class="method-args">(type: :export)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="plugin_regex-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1822</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">plugin_regex</span>(<span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)
  <span class="ruby-identifier">pattern</span> = []
  <span class="ruby-identifier">plugins</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">pattern</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:trigger</span>]
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^(?:#{pattern.join(&#39;|&#39;)})$&quot;</span>, <span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-plugin_templates" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">plugin_templates</span><span
            class="method-args">(type: :export)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="plugin_templates-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1830</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">plugin_templates</span>(<span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)
  <span class="ruby-identifier">templates</span> = []
  <span class="ruby-identifier">plugs</span> = <span class="ruby-identifier">plugins</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">clone</span>
  <span class="ruby-identifier">plugs</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">templates</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>[<span class="ruby-value">:name</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">templates</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-plugins" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">plugins</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="plugins-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1808</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">plugins</span>
  <span class="ruby-ivar">@plugins</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">load_plugins</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-read_config" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">read_config</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Reads a configuration.</p>

          <div class="method-source-code" id="read_config-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">read_config</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-ivar">@config_file</span> <span class="ruby-operator">||=</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Dir</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-string">&#39;home&#39;</span>)
                     <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">home</span>, <span class="ruby-ivar">@default_config_file</span>)
                   <span class="ruby-keyword">else</span>
                     <span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-string">&#39;~&#39;</span>), <span class="ruby-ivar">@default_config_file</span>)
                   <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">additional_configs</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:ignore_local</span>]
                         []
                       <span class="ruby-keyword">else</span>
                         <span class="ruby-identifier">find_local_config</span>
                       <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">begin</span>
    <span class="ruby-ivar">@local_config</span> = {}

    <span class="ruby-ivar">@config</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-ivar">@config_file</span>) <span class="ruby-operator">||</span> {} <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-ivar">@config_file</span>)
    <span class="ruby-identifier">additional_configs</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">cfg</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">new_config</span> = <span class="ruby-constant">YAML</span>.<span class="ruby-identifier">load_file</span>(<span class="ruby-identifier">cfg</span>) <span class="ruby-operator">||</span> {} <span class="ruby-keyword">if</span> <span class="ruby-identifier">cfg</span>
      <span class="ruby-ivar">@local_config</span> = <span class="ruby-ivar">@local_config</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-identifier">new_config</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-comment"># @config.deep_merge(@local_config)</span>
  <span class="ruby-keyword">rescue</span> <span class="ruby-constant">StandardError</span>
    <span class="ruby-ivar">@config</span> = {}
    <span class="ruby-ivar">@local_config</span> = {}
    <span class="ruby-comment"># exit_now! &quot;error reading config&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-recent" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">recent</span><span
            class="method-args">(count = 10, section = nil, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Show recent entries</p>

<p>@param count (Integer) The number to show @param section (String) The section to show from, default Currently @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="recent-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2114</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">recent</span>(<span class="ruby-identifier">count</span> = <span class="ruby-value">10</span>, <span class="ruby-identifier">section</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">times</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:t</span>] <span class="ruby-operator">||</span> <span class="ruby-keyword">true</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">cfg</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;recent&#39;</span>]
  <span class="ruby-identifier">section</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@current_section</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)

  <span class="ruby-identifier">list_section</span>({ <span class="ruby-value">section:</span> <span class="ruby-identifier">section</span>, <span class="ruby-value">wrap_width:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;wrap_width&#39;</span>], <span class="ruby-value">count:</span> <span class="ruby-identifier">count</span>,
                 <span class="ruby-value">format:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;date_format&#39;</span>], <span class="ruby-value">template:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;template&#39;</span>],
                 <span class="ruby-value">order:</span> <span class="ruby-string">&#39;asc&#39;</span>, <span class="ruby-value">times:</span> <span class="ruby-identifier">times</span>, <span class="ruby-value">totals:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>],
                 <span class="ruby-value">sort_tags:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>], <span class="ruby-value">tags_color:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tags_color</span>] })
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-record_tag_times" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">record_tag_times</span><span
            class="method-args">(item, seconds)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Record times for item tags</p>

<p>@param item The item</p>

          <div class="method-source-code" id="record_tag_times-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2392</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">record_tag_times</span>(<span class="ruby-identifier">item</span>, <span class="ruby-identifier">seconds</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@recorded_items</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">item</span>)

  <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">scan</span>(<span class="ruby-regexp">/(?mi)@(\S+?)(\(.*\))?(?=\s|$)/</span>).<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">k</span> = <span class="ruby-identifier">m</span>[<span class="ruby-value">0</span>] <span class="ruby-operator">==</span> <span class="ruby-string">&#39;done&#39;</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;All&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">m</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">downcase</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">k</span>)
      <span class="ruby-ivar">@timers</span>[<span class="ruby-identifier">k</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">seconds</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@timers</span>[<span class="ruby-identifier">k</span>] = <span class="ruby-identifier">seconds</span>
    <span class="ruby-keyword">end</span>
    <span class="ruby-ivar">@recorded_items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">item</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-restart_last" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">restart_last</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Restart the last entry</p>

<p>@param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="restart_last-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 674</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">restart_last</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">||=</span> <span class="ruby-string">&#39;all&#39;</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>] <span class="ruby-operator">||=</span> []
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_bool</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">:and</span>

  <span class="ruby-identifier">last</span> = <span class="ruby-identifier">last_entry</span>(<span class="ruby-identifier">opt</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">last</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">%(No previous entry found)</span>)
    <span class="ruby-keyword">return</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">last</span>.<span class="ruby-identifier">has_tags?</span>([<span class="ruby-string">&#39;done&#39;</span>], <span class="ruby-string">&#39;ALL&#39;</span>)
    <span class="ruby-identifier">new_item</span> = <span class="ruby-identifier">last</span>.<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">new_item</span>[<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; @done(#{Time.now.strftime(&#39;%F %R&#39;)})&quot;</span>
    <span class="ruby-identifier">update_item</span>(<span class="ruby-identifier">last</span>, <span class="ruby-identifier">new_item</span>)
  <span class="ruby-keyword">end</span>
  <span class="ruby-comment"># Remove @done tag</span>
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">last</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\s*@done(\(.*?\))?/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">chomp</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:in</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">last</span>[<span class="ruby-string">&#39;section&#39;</span>] <span class="ruby-operator">:</span> <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:in</span>])
  <span class="ruby-ivar">@auto_tag</span> = <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">add_item</span>(<span class="ruby-identifier">title</span>, <span class="ruby-identifier">section</span>, { <span class="ruby-value">note:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>], <span class="ruby-value">back:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date</span>], <span class="ruby-value">timed:</span> <span class="ruby-keyword">true</span> })
  <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-restore_backup" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">restore_backup</span><span
            class="method-args">(file)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Restore a backed up version of a file</p>

<p>@param file (String) The filepath to restore</p>

          <div class="method-source-code" id="restore_backup-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1541</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">restore_backup</span>(<span class="ruby-identifier">file</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;~&#39;</span>)
    <span class="ruby-identifier">puts</span> <span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;~&#39;</span>
    <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">file</span> <span class="ruby-operator">+</span> <span class="ruby-string">&#39;~&#39;</span>, <span class="ruby-identifier">file</span>)
    <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Restored #{file}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-rotate" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">rotate</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Rename doing file with date and start fresh one</p>

          <div class="method-source-code" id="rotate-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1552</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">rotate</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">count</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:keep</span>] <span class="ruby-operator">||</span> <span class="ruby-value">0</span>
  <span class="ruby-identifier">tags</span> = []
  <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/ *, */</span>).<span class="ruby-identifier">map</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/^@/</span>, <span class="ruby-string">&#39;&#39;</span>).<span class="ruby-identifier">strip</span> }) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
  <span class="ruby-identifier">bool</span>  = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:bool</span>] <span class="ruby-operator">||</span> <span class="ruby-value">:and</span>
  <span class="ruby-identifier">sect</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">!~</span> <span class="ruby-regexp">/^all$/i</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]) <span class="ruby-operator">:</span> <span class="ruby-string">&#39;all&#39;</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">sect</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
    <span class="ruby-identifier">all_sections</span> = <span class="ruby-identifier">sections</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">all_sections</span> = [<span class="ruby-identifier">sect</span>]
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">counter</span> = <span class="ruby-value">0</span>
  <span class="ruby-identifier">new_content</span> = {}


  <span class="ruby-identifier">all_sections</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>
    <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>] = {}
    <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;original&#39;</span>] = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;original&#39;</span>]
    <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = []

    <span class="ruby-identifier">moved_items</span> = []
    <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
        <span class="ruby-identifier">time_string</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]
        <span class="ruby-identifier">time_string</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; 12am&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">time_string</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/(\d+:\d+|\d+[ap])/</span>
        <span class="ruby-identifier">cutoff</span> = <span class="ruby-identifier">chronify</span>(<span class="ruby-identifier">time_string</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">delete_if</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">if</span> ((<span class="ruby-operator">!</span><span class="ruby-identifier">tags</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">tags</span>, <span class="ruby-identifier">bool</span>)) <span class="ruby-operator">||</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">to_s</span>)) <span class="ruby-operator">||</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">cutoff</span>))
          <span class="ruby-identifier">moved_items</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">item</span>)
          <span class="ruby-identifier">counter</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
          <span class="ruby-keyword">true</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-keyword">false</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">items</span>
      <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">moved_items</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Rotated #{moved_items.length} items from #{section}&quot;</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = []
      <span class="ruby-identifier">moved_items</span> = []

      <span class="ruby-identifier">count</span> = <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">&lt;</span> <span class="ruby-identifier">count</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">count</span> <span class="ruby-operator">&gt;</span> <span class="ruby-identifier">count</span>
        <span class="ruby-identifier">moved_items</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">items</span>[<span class="ruby-identifier">count</span><span class="ruby-operator">..</span><span class="ruby-value">-1</span>])
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">moved_items</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-identifier">items</span>)
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-keyword">if</span> <span class="ruby-identifier">count</span>.<span class="ruby-identifier">zero?</span>
                                     []
                                   <span class="ruby-keyword">else</span>
                                     <span class="ruby-identifier">items</span>[<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">count</span> <span class="ruby-operator">-</span> <span class="ruby-value">1</span>]
                                   <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">new_content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">moved_items</span>

      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Rotated #{items.length - count} items from #{section}&quot;</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)

  <span class="ruby-identifier">file</span> = <span class="ruby-ivar">@doing_file</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/(\.\w+)$/</span>, <span class="ruby-node">&quot;_#{Time.now.strftime(&#39;%Y-%m-%d&#39;)}\\1&quot;</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-identifier">init_doing_file</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">deep_merge</span>(<span class="ruby-identifier">new_content</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-ivar">@content</span> = <span class="ruby-identifier">new_content</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write</span>(<span class="ruby-identifier">file</span>, <span class="ruby-value">backup:</span> <span class="ruby-keyword">false</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-same_time-3F" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">same_time?</span><span
            class="method-args">(item_a, item_b)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="same_time-3F-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 589</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">same_time?</span>(<span class="ruby-identifier">item_a</span>, <span class="ruby-identifier">item_b</span>)
  <span class="ruby-identifier">item_a</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">==</span> <span class="ruby-identifier">item_b</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">?</span> <span class="ruby-identifier">get_interval</span>(<span class="ruby-identifier">item_a</span>, <span class="ruby-value">formatted:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">false</span>) <span class="ruby-operator">==</span> <span class="ruby-identifier">get_interval</span>(<span class="ruby-identifier">item_b</span>,  <span class="ruby-value">formatted:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">record:</span> <span class="ruby-keyword">false</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-sections" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">sections</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief List sections</p>

<p>@return (Array) section titles</p>

          <div class="method-source-code" id="sections-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 410</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">sections</span>
  <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-stop_start" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">stop_start</span><span
            class="method-args">(target_tag, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Accepts one tag and the raw text of a new item if the passed tag  is on any item, it&#39;s replaced with @done. if new_item is not  nil, it&#39;s tagged with the passed tag and inserted. This is for  use where only one instance of a given tag should exist  (@meanwhile)</p>

<p>@param tag (String) Tag to replace @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="stop_start-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1455</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">stop_start</span>(<span class="ruby-identifier">target_tag</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">target_tag</span>.<span class="ruby-identifier">dup</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">||=</span> <span class="ruby-ivar">@current_section</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] <span class="ruby-operator">||=</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:new_item</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>])

  <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/^@/</span>, <span class="ruby-string">&#39;&#39;</span>)

  <span class="ruby-identifier">found_items</span> = <span class="ruby-value">0</span>
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">each_with_index</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">next</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@#{tag}/</span>

    <span class="ruby-identifier">title</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/(^| )@(#{tag}|done)(\([^)]*\))?/</span>, <span class="ruby-string">&#39;&#39;</span>)
    <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; @done(#{opt[:back].strftime(&#39;%F %R&#39;)})&quot;</span>

    <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">i</span>][<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
    <span class="ruby-identifier">found_items</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>

    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;Archive&#39;</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Completed and archived &quot;#{@content[opt[:section]][&#39;items&#39;][i][&#39;title&#39;]}&quot;)</span>)
      <span class="ruby-identifier">archive_item</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">i</span>]
      <span class="ruby-identifier">archive_item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">i</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/(?:@from\(.*?\))?(.*)$/</span>, <span class="ruby-node">&quot;\\1 @from(#{i[&#39;section&#39;]})&quot;</span>)
      <span class="ruby-ivar">@content</span>[<span class="ruby-string">&#39;Archive&#39;</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">push</span>(<span class="ruby-identifier">archive_item</span>)
      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">delete_at</span>(<span class="ruby-identifier">i</span>)
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Completed &quot;#{@content[opt[:section]][&#39;items&#39;][i][&#39;title&#39;]}&quot;)</span>)
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;No active @#{tag} tasks found.&quot;</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">found_items</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:new_item</span>]
    <span class="ruby-identifier">title</span>, <span class="ruby-identifier">note</span> = <span class="ruby-identifier">format_input</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:new_item</span>])
    <span class="ruby-identifier">note</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>].<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:chomp</span>)) <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:note</span>]
    <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; @#{tag}&quot;</span>
    <span class="ruby-identifier">add_item</span>(<span class="ruby-identifier">title</span>.<span class="ruby-identifier">cap_first</span>, <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>], { <span class="ruby-value">note:</span> <span class="ruby-identifier">note</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&#39; &#39;</span>).<span class="ruby-identifier">rstrip</span>, <span class="ruby-value">back:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] })
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tag_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tag_item</span><span
            class="method-args">(old_item, tags, remove: false, date: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Tag an item from the index</p>

<p>@param old_item (Item) The item to tag @param tag (string) The tag to apply @param date (Boolean) Include timestamp?</p>

          <div class="method-source-code" id="tag_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1284</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tag_item</span>(<span class="ruby-identifier">old_item</span>, <span class="ruby-identifier">tags</span>, <span class="ruby-value">remove:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">date:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">old_item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-operator">::</span><span class="ruby-constant">String</span>
    <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/ *, */</span>).<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:strip</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">done_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
  <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/@#{tag}/</span>
      <span class="ruby-identifier">title</span>.<span class="ruby-identifier">chomp!</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">date</span>
        <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; @#{tag}(#{done_date.strftime(&#39;%F %R&#39;)})&quot;</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot; @#{tag}&quot;</span>
      <span class="ruby-keyword">end</span>
      <span class="ruby-identifier">new_item</span> = <span class="ruby-identifier">old_item</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">new_item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
      <span class="ruby-identifier">update_item</span>(<span class="ruby-identifier">old_item</span>, <span class="ruby-identifier">new_item</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_item</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Item already @#{tag}: &quot;#{title}&quot; in #{old_item[&#39;section&#39;]})</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">old_item</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tag_last" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tag_last</span><span
            class="method-args">(opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Tag the last entry or X entries</p>

<p>@param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="tag_last-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1023</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tag_last</span>(<span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tags</span>] <span class="ruby-operator">||=</span> [<span class="ruby-string">&#39;done&#39;</span>]
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sequential</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:autotag</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:took</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">nil</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:unfinished</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">sec_arr</span> = []

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">nil?</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
      <span class="ruby-identifier">sec_arr</span> = <span class="ruby-identifier">sections</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sec_arr</span> = [<span class="ruby-ivar">@current_section</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>].<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">String</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>] <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^all$/i</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span>
        <span class="ruby-identifier">combined</span> = { <span class="ruby-string">&#39;items&#39;</span> <span class="ruby-operator">=&gt;</span> [] }
        <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>] <span class="ruby-operator">+=</span> <span class="ruby-identifier">v</span>[<span class="ruby-string">&#39;items&#39;</span>]
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">items</span> = <span class="ruby-identifier">combined</span>[<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>
        <span class="ruby-identifier">sec_arr</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">items</span>[<span class="ruby-value">0</span>][<span class="ruby-string">&#39;section&#39;</span>])
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>]
          <span class="ruby-identifier">sec_arr</span> = <span class="ruby-identifier">sections</span>
        <span class="ruby-keyword">else</span>
          <span class="ruby-identifier">exit_now!</span> <span class="ruby-string">&#39;A count greater than one requires a section to be specified&#39;</span>
        <span class="ruby-keyword">end</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">sec_arr</span> = <span class="ruby-identifier">sections</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">sec_arr</span> = [<span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>])]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">sec_arr</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-identifier">section</span>)

      <span class="ruby-identifier">items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>].<span class="ruby-identifier">dup</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] }.<span class="ruby-identifier">reverse</span>
      <span class="ruby-identifier">idx</span> = <span class="ruby-value">0</span>
      <span class="ruby-identifier">done_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
      <span class="ruby-identifier">count</span> = (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]).<span class="ruby-identifier">zero?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">items</span>.<span class="ruby-identifier">length</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]
      <span class="ruby-identifier">items</span>.<span class="ruby-identifier">map!</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">item</span><span class="ruby-operator">|</span>
        <span class="ruby-keyword">break</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">idx</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">count</span>
        <span class="ruby-identifier">finished</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:unfinished</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-string">&#39;done&#39;</span>, <span class="ruby-value">:and</span>)
        <span class="ruby-identifier">tag_match</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">has_tags?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag</span>], <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_bool</span>])
        <span class="ruby-identifier">search_match</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>].<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-keyword">true</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">item</span>.<span class="ruby-identifier">matches_search?</span>(<span class="ruby-identifier">opt</span>[<span class="ruby-value">:search</span>])

        <span class="ruby-keyword">if</span> <span class="ruby-identifier">tag_match</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">search_match</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">finished</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:autotag</span>]
            <span class="ruby-identifier">new_title</span> = <span class="ruby-identifier">autotag</span>(<span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]) <span class="ruby-keyword">if</span> <span class="ruby-ivar">@auto_tag</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">new_title</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]
              <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">%(Autotag: No changes)</span>)
            <span class="ruby-keyword">else</span>
              <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Tags updated: #{new_title}&quot;</span>)
              <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">new_title</span>
            <span class="ruby-keyword">end</span>
          <span class="ruby-keyword">else</span>
            <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sequential</span>]
              <span class="ruby-identifier">next_entry</span> = <span class="ruby-identifier">next_item</span>(<span class="ruby-identifier">item</span>)

              <span class="ruby-keyword">if</span> <span class="ruby-identifier">next_entry</span>.<span class="ruby-identifier">nil?</span>
                <span class="ruby-identifier">done_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">done_date</span> = <span class="ruby-identifier">next_entry</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">-</span> <span class="ruby-value">60</span>
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:took</span>]
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:took</span>] <span class="ruby-operator">&gt;</span> <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
                <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:took</span>]
                <span class="ruby-identifier">done_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">done_date</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:took</span>]
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>]
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>].<span class="ruby-identifier">is_a?</span> <span class="ruby-constant">Integer</span>
                <span class="ruby-identifier">done_date</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">+</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>]
              <span class="ruby-keyword">else</span>
                <span class="ruby-identifier">done_date</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>] <span class="ruby-operator">+</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:back</span>] <span class="ruby-operator">-</span> <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;date&#39;</span>])
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-identifier">done_date</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
            <span class="ruby-keyword">end</span>

            <span class="ruby-identifier">title</span> = <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>]
            <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tags</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
              <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">strip</span>
              <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:remove</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:rename</span>]
                <span class="ruby-identifier">case_sensitive</span> = <span class="ruby-identifier">tag</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/[A-Z]/</span>
                <span class="ruby-identifier">replacement</span> = <span class="ruby-string">&#39;&#39;</span>
                <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:rename</span>]
                  <span class="ruby-identifier">replacement</span> = <span class="ruby-identifier">tag</span>
                  <span class="ruby-identifier">tag</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:rename</span>]
                <span class="ruby-keyword">end</span>

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:regex</span>]
                  <span class="ruby-identifier">rx_tag</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\./</span>, <span class="ruby-string">&#39;\S&#39;</span>)
                <span class="ruby-keyword">else</span>
                  <span class="ruby-identifier">rx_tag</span> = <span class="ruby-identifier">tag</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\?/</span>, <span class="ruby-string">&#39;.&#39;</span>).<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\*/</span>, <span class="ruby-string">&#39;\S*?&#39;</span>)
                <span class="ruby-keyword">end</span>

                <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/ @#{rx_tag}\b/</span>
                  <span class="ruby-identifier">rx</span> = <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;(^| )@#{rx_tag}(\\([^)]*\\))?(?=\\b|$)&quot;</span>, <span class="ruby-identifier">case_sensitive</span>)
                  <span class="ruby-identifier">removed_tags</span> = []
                  <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-identifier">rx</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">mtch</span><span class="ruby-operator">|</span>
                    <span class="ruby-identifier">removed_tags</span>.<span class="ruby-identifier">push</span>(<span class="ruby-identifier">mtch</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">sub</span>(<span class="ruby-regexp">/\(.*?\)$/</span>, <span class="ruby-string">&#39;&#39;</span>))
                    <span class="ruby-identifier">replacement</span>
                  <span class="ruby-keyword">end</span>

                  <span class="ruby-identifier">title</span>.<span class="ruby-identifier">dedup_tags!</span>

                  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Removed #{removed_tags.join(&#39;, &#39;)}: &quot;#{title}&quot; in #{section})</span>)
                <span class="ruby-keyword">end</span>
              <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">!~</span> <span class="ruby-regexp">/@#{tag}/</span>
                <span class="ruby-identifier">title</span>.<span class="ruby-identifier">chomp!</span>
                <span class="ruby-identifier">title</span> <span class="ruby-operator">+=</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:date</span>]
                           <span class="ruby-node">&quot; @#{tag}(#{done_date.strftime(&#39;%F %R&#39;)})&quot;</span>
                         <span class="ruby-keyword">else</span>
                           <span class="ruby-node">&quot; @#{tag}&quot;</span>
                         <span class="ruby-keyword">end</span>
                <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Added @#{tag}: &quot;#{title}&quot; in #{section})</span>)
              <span class="ruby-keyword">end</span>
            <span class="ruby-keyword">end</span>
            <span class="ruby-identifier">item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
          <span class="ruby-keyword">end</span>

          <span class="ruby-identifier">idx</span> <span class="ruby-operator">+=</span> <span class="ruby-value">1</span>
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">item</span>
      <span class="ruby-keyword">end</span>

      <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">items</span>

      <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">section</span> <span class="ruby-operator">!=</span> <span class="ruby-string">&#39;Archive&#39;</span> <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]).<span class="ruby-identifier">positive?</span>
        <span class="ruby-comment"># concat [count] items from [section] and archive section</span>
        <span class="ruby-identifier">archived</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-value">0</span><span class="ruby-operator">..</span><span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">-</span> <span class="ruby-value">1</span>].<span class="ruby-identifier">map</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">i</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">i</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">sub!</span>(<span class="ruby-regexp">/(?:@from\(.*?\))?(.*)$/</span>, <span class="ruby-node">&quot;\\1 @from(#{i[&#39;section&#39;]})&quot;</span>)
          <span class="ruby-identifier">i</span>
        <span class="ruby-keyword">end</span>.<span class="ruby-identifier">concat</span>(<span class="ruby-ivar">@content</span>[<span class="ruby-string">&#39;Archive&#39;</span>][<span class="ruby-string">&#39;items&#39;</span>])
        <span class="ruby-comment"># slice [count] items off of [section] items</span>
        <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>]][<span class="ruby-string">&#39;items&#39;</span>][<span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]<span class="ruby-operator">..</span><span class="ruby-value">-1</span>]
        <span class="ruby-comment"># overwrite archive section with concatenated array</span>
        <span class="ruby-ivar">@content</span>[<span class="ruby-string">&#39;Archive&#39;</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">archived</span>
        <span class="ruby-comment"># log it</span>
        <span class="ruby-identifier">result</span> = <span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>] <span class="ruby-operator">==</span> <span class="ruby-value">1</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;1 entry&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{opt[:count]} entries&quot;</span>
        <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Archived #{result} from #{section}&quot;</span>)
      <span class="ruby-keyword">elsif</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:archive</span>] <span class="ruby-operator">&amp;&amp;</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]).<span class="ruby-identifier">zero?</span>
        <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-string">&#39;Archiving is skipped when operating on all entries&#39;</span>) <span class="ruby-keyword">if</span> (<span class="ruby-identifier">opt</span>[<span class="ruby-value">:count</span>]).<span class="ruby-identifier">zero?</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;Section not found: #{section}&quot;</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">write</span>(<span class="ruby-ivar">@doing_file</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-tag_times" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">tag_times</span><span
            class="method-args">(format: :text, sort_by_name: false, sort_order: &#39;asc&#39;)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Get total elapsed time for all tags in  selection</p>

<p>@param format (String) return format (html,  json, or text) @param sort_by_name (Boolean) Sort by name if true, otherwise by time @param sort_order (String) The sort order (asc or desc)</p>

          <div class="method-source-code" id="tag_times-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2233</span>
    <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">tag_times</span>(<span class="ruby-value">format:</span> <span class="ruby-value">:text</span>, <span class="ruby-value">sort_by_name:</span> <span class="ruby-keyword">false</span>, <span class="ruby-value">sort_order:</span> <span class="ruby-string">&#39;asc&#39;</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-keyword">if</span> <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">empty?</span>

      <span class="ruby-identifier">max</span> = <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">keys</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">length</span> }.<span class="ruby-identifier">reverse</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">length</span> <span class="ruby-operator">+</span> <span class="ruby-value">1</span>

      <span class="ruby-identifier">total</span> = <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-string">&#39;All&#39;</span>)

      <span class="ruby-identifier">tags_data</span> = <span class="ruby-ivar">@timers</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> }
      <span class="ruby-identifier">sorted_tags_data</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">sort_by_name</span>
                           <span class="ruby-identifier">tags_data</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">_v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> }
                         <span class="ruby-keyword">else</span>
                           <span class="ruby-identifier">tags_data</span>.<span class="ruby-identifier">sort_by</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">_k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">v</span> }
                         <span class="ruby-keyword">end</span>

      <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">reverse!</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">sort_order</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^asc/i</span>
      <span class="ruby-keyword">case</span> <span class="ruby-identifier">format</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:html</span>

        <span class="ruby-identifier">output</span> = <span class="ruby-identifier">&lt;&lt;EOS</span>
<span class="ruby-value">          &lt;table&gt;
          &lt;caption id=&quot;tagtotals&quot;&gt;Tag Totals&lt;/caption&gt;
          &lt;colgroup&gt;
          &lt;col style=&quot;text-align:left;&quot;/&gt;
          &lt;col style=&quot;text-align:left;&quot;/&gt;
          &lt;/colgroup&gt;
          &lt;thead&gt;
          &lt;tr&gt;
            &lt;th style=&quot;text-align:left;&quot;&gt;project&lt;/th&gt;
            &lt;th style=&quot;text-align:left;&quot;&gt;time&lt;/th&gt;
          &lt;/tr&gt;
          &lt;/thead&gt;
          &lt;tbody&gt;
</span><span class="ruby-identifier">EOS</span>
        <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
            <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;&lt;tr&gt;&lt;td style=&#39;text-align:left;&#39;&gt;#{k}&lt;/td&gt;&lt;td style=&#39;text-align:left;&#39;&gt;#{&#39;%02d:%02d:%02d&#39; % fmt_time(v)}&lt;/td&gt;&lt;/tr&gt;\n&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">tail</span> = <span class="ruby-identifier">&lt;&lt;EOS</span>
<span class="ruby-value">        &lt;tr&gt;
          &lt;td style=&quot;text-align:left;&quot; colspan=&quot;2&quot;&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;/tbody&gt;
        &lt;tfoot&gt;
        &lt;tr&gt;
          &lt;td style=&quot;text-align:left;&quot;&gt;&lt;strong&gt;Total&lt;/strong&gt;&lt;/td&gt;
          &lt;td style=&quot;text-align:left;&quot;&gt;#{&#39;%02d:%02d:%02d&#39; % fmt_time(total)}&lt;/td&gt;
        &lt;/tr&gt;
        &lt;/tfoot&gt;
        &lt;/table&gt;
</span><span class="ruby-identifier">EOS</span>
        <span class="ruby-identifier">output</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tail</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:markdown</span>
        <span class="ruby-identifier">pad</span> = <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span> <span class="ruby-identifier">k</span> }.<span class="ruby-identifier">group_by</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:size</span>).<span class="ruby-identifier">max</span>.<span class="ruby-identifier">last</span>[<span class="ruby-value">0</span>].<span class="ruby-identifier">length</span>
        <span class="ruby-identifier">output</span> = <span class="ruby-identifier">&lt;&lt;-EOS</span>
<span class="ruby-value">  | #{&#39; &#39; * (pad - 7) }project | time     |
  | #{&#39;-&#39; * (pad - 1)}: | :------- |
</span><span class="ruby-identifier">        EOS</span>
        <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
          <span class="ruby-keyword">if</span> <span class="ruby-identifier">v</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
            <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;| #{&#39; &#39; * (pad - k.length)}#{k} | #{&#39;%02d:%02d:%02d&#39; % fmt_time(v)} |\n&quot;</span>
          <span class="ruby-keyword">end</span>
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">tail</span> = <span class="ruby-string">&quot;[Tag Totals]&quot;</span>
        <span class="ruby-identifier">output</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">tail</span>
      <span class="ruby-keyword">when</span> <span class="ruby-value">:json</span>
        <span class="ruby-identifier">output</span> = []
        <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">d</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">m</span> = <span class="ruby-identifier">fmt_time</span>(<span class="ruby-identifier">v</span>)
          <span class="ruby-identifier">output</span> <span class="ruby-operator">&lt;&lt;</span> {
            <span class="ruby-string">&#39;tag&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">k</span>,
            <span class="ruby-string">&#39;seconds&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">v</span>,
            <span class="ruby-string">&#39;formatted&#39;</span> <span class="ruby-operator">=&gt;</span> <span class="ruby-identifier">format</span>(<span class="ruby-string">&#39;%&lt;d&gt;02d:%&lt;h&gt;02d:%&lt;m&gt;02d&#39;</span>, <span class="ruby-value">d:</span> <span class="ruby-identifier">d</span>, <span class="ruby-value">h:</span> <span class="ruby-identifier">h</span>, <span class="ruby-value">m:</span> <span class="ruby-identifier">m</span>)
          }
        <span class="ruby-keyword">end</span>
        <span class="ruby-identifier">output</span>
      <span class="ruby-keyword">else</span>
        <span class="ruby-identifier">output</span> = []
        <span class="ruby-identifier">sorted_tags_data</span>.<span class="ruby-identifier">reverse</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">k</span>, <span class="ruby-identifier">v</span><span class="ruby-operator">|</span>
          <span class="ruby-identifier">spacer</span> = <span class="ruby-string">&#39;&#39;</span>
          (<span class="ruby-identifier">max</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">k</span>.<span class="ruby-identifier">length</span>).<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
            <span class="ruby-identifier">spacer</span> <span class="ruby-operator">+=</span> <span class="ruby-string">&#39; &#39;</span>
          <span class="ruby-keyword">end</span>
          <span class="ruby-identifier">d</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">m</span> = <span class="ruby-identifier">fmt_time</span>(<span class="ruby-identifier">v</span>)
          <span class="ruby-identifier">output</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;#{k}:#{spacer}#{format(&#39;%&lt;d&gt;02d:%&lt;h&gt;02d:%&lt;m&gt;02d&#39;, d: d, h: h, m: m)}&quot;</span>)
        <span class="ruby-keyword">end</span>

        <span class="ruby-identifier">output</span> = <span class="ruby-identifier">output</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">?</span> <span class="ruby-string">&#39;&#39;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;\n--- Tag Totals ---\n#{output.join(&quot;\n&quot;)}&quot;</span>
        <span class="ruby-identifier">d</span>, <span class="ruby-identifier">h</span>, <span class="ruby-identifier">m</span> = <span class="ruby-identifier">fmt_time</span>(<span class="ruby-identifier">total</span>)
        <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;\n\nTotal tracked: #{format(&#39;%&lt;d&gt;02d:%&lt;h&gt;02d:%&lt;m&gt;02d&#39;, d: d, h: h, m: m)}\n&quot;</span>
        <span class="ruby-identifier">output</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-template_for_trigger" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">template_for_trigger</span><span
            class="method-args">(trigger, type: :export)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="template_for_trigger-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1853</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">template_for_trigger</span>(<span class="ruby-identifier">trigger</span>, <span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)
  <span class="ruby-identifier">plugs</span> = <span class="ruby-identifier">plugins</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">clone</span>
  <span class="ruby-identifier">plugs</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">trigger</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/^(?:#{t[:trigger]})$/</span>
        <span class="ruby-identifier">puts</span> <span class="ruby-identifier">options</span>
        <span class="ruby-keyword">return</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:class</span>].<span class="ruby-identifier">template</span>(<span class="ruby-identifier">trigger</span>)
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">exit_now!</span> <span class="ruby-node">&quot;No template type matched \&quot;#{trigger}\&quot;&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-template_regex" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">template_regex</span><span
            class="method-args">(type: :export)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          

          <div class="method-source-code" id="template_regex-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1842</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">template_regex</span>(<span class="ruby-value">type:</span> <span class="ruby-value">:export</span>)
  <span class="ruby-identifier">pattern</span> = []
  <span class="ruby-identifier">plugs</span> = <span class="ruby-identifier">plugins</span>[<span class="ruby-identifier">type</span>].<span class="ruby-identifier">clone</span>
  <span class="ruby-identifier">plugs</span>.<span class="ruby-identifier">delete_if</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">o</span><span class="ruby-operator">|</span> <span class="ruby-identifier">o</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">nil?</span> }.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">_</span>, <span class="ruby-identifier">options</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">options</span>[<span class="ruby-value">:templates</span>].<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">pattern</span> <span class="ruby-operator">&lt;&lt;</span> <span class="ruby-identifier">t</span>[<span class="ruby-value">:trigger</span>]
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-constant">Regexp</span>.<span class="ruby-identifier">new</span>(<span class="ruby-node">&quot;^(?:#{pattern.join(&#39;|&#39;)})$&quot;</span>, <span class="ruby-keyword">true</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-today" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">today</span><span
            class="method-args">(times = true, output = nil, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Show all entries from the current day</p>

<p>@param times (Boolean) show times @param output (String) output format @param opt (Hash) Options</p>

          <div class="method-source-code" id="today-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2031</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">today</span>(<span class="ruby-identifier">times</span> = <span class="ruby-keyword">true</span>, <span class="ruby-identifier">output</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>

  <span class="ruby-identifier">cfg</span> = <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;templates&#39;</span>][<span class="ruby-string">&#39;today&#39;</span>]
  <span class="ruby-identifier">options</span> = {
    <span class="ruby-value">after:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>],
    <span class="ruby-value">before:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>],
    <span class="ruby-value">count:</span> <span class="ruby-value">0</span>,
    <span class="ruby-value">format:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;date_format&#39;</span>],
    <span class="ruby-value">order:</span> <span class="ruby-string">&#39;asc&#39;</span>,
    <span class="ruby-value">output:</span> <span class="ruby-identifier">output</span>,
    <span class="ruby-value">section:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:section</span>],
    <span class="ruby-value">sort_tags:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>],
    <span class="ruby-value">template:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;template&#39;</span>],
    <span class="ruby-value">times:</span> <span class="ruby-identifier">times</span>,
    <span class="ruby-value">today:</span> <span class="ruby-keyword">true</span>,
    <span class="ruby-value">totals:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>],
    <span class="ruby-value">wrap_width:</span> <span class="ruby-identifier">cfg</span>[<span class="ruby-string">&#39;wrap_width&#39;</span>]
  }
  <span class="ruby-identifier">list_section</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-untag_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">untag_item</span><span
            class="method-args">(old_item, tags)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Remove a tag on an item from the index</p>

<p>@param old_item (Item) The item to tag @param tag (string) The tag to remove</p>

          <div class="method-source-code" id="untag_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1256</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">untag_item</span>(<span class="ruby-identifier">old_item</span>, <span class="ruby-identifier">tags</span>)
  <span class="ruby-identifier">title</span> = <span class="ruby-identifier">old_item</span>[<span class="ruby-string">&#39;title&#39;</span>].<span class="ruby-identifier">dup</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">is_a?</span> <span class="ruby-operator">::</span><span class="ruby-constant">String</span>
    <span class="ruby-identifier">tags</span> = <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">split</span>(<span class="ruby-regexp">/ *, */</span>).<span class="ruby-identifier">map</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">t</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span>.<span class="ruby-identifier">strip</span>.<span class="ruby-identifier">gsub</span>(<span class="ruby-regexp">/\*/</span>,<span class="ruby-string">&#39;[^ (]*&#39;</span>) }
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">tags</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">tag</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">title</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/@#{tag}/</span>
      <span class="ruby-identifier">title</span>.<span class="ruby-identifier">chomp!</span>
      <span class="ruby-identifier">title</span>.<span class="ruby-identifier">gsub!</span>(<span class="ruby-regexp">/ +@#{tag}(\(.*?\))?/</span>, <span class="ruby-string">&#39;&#39;</span>)
      <span class="ruby-identifier">new_item</span> = <span class="ruby-identifier">old_item</span>.<span class="ruby-identifier">dup</span>
      <span class="ruby-identifier">new_item</span>[<span class="ruby-string">&#39;title&#39;</span>] = <span class="ruby-identifier">title</span>
      <span class="ruby-identifier">update_item</span>(<span class="ruby-identifier">old_item</span>, <span class="ruby-identifier">new_item</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">new_item</span>
    <span class="ruby-keyword">else</span>
      <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">%(Item isn&#39;t tagged @#{tag}: &quot;#{title}&quot; in #{old_item[&#39;section&#39;]})</span>)
      <span class="ruby-keyword">return</span> <span class="ruby-identifier">old_item</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-update_item" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">update_item</span><span
            class="method-args">(old_item, new_item)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Update an item in the index with a modified item</p>

<p>@param old_item The old item @param new_item The new item</p>

          <div class="method-source-code" id="update_item-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1316</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">update_item</span>(<span class="ruby-identifier">old_item</span>, <span class="ruby-identifier">new_item</span>)
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">old_item</span>[<span class="ruby-string">&#39;section&#39;</span>]

  <span class="ruby-identifier">section_items</span> = <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>]
  <span class="ruby-identifier">s_idx</span> = <span class="ruby-identifier">section_items</span>.<span class="ruby-identifier">index</span>(<span class="ruby-identifier">old_item</span>)

  <span class="ruby-identifier">section_items</span>[<span class="ruby-identifier">s_idx</span>] = <span class="ruby-identifier">new_item</span>
  <span class="ruby-ivar">@results</span>.<span class="ruby-identifier">push</span>(<span class="ruby-node">&quot;Entry updated: #{section_items[s_idx][&#39;title&#39;]}&quot;</span>)
  <span class="ruby-ivar">@content</span>[<span class="ruby-identifier">section</span>][<span class="ruby-string">&#39;items&#39;</span>] = <span class="ruby-identifier">section_items</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-views" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">views</span><span
            class="method-args">()</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief List available views</p>

<p>@return (Array) View names</p>

          <div class="method-source-code" id="views-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1646</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">views</span>
  <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-string">&#39;views&#39;</span>) <span class="ruby-operator">?</span> <span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;views&#39;</span>].<span class="ruby-identifier">keys</span> <span class="ruby-operator">:</span> []
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-write" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">write</span><span
            class="method-args">(file = nil, backup: true)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Write content to file or STDOUT</p>

<p>@param file (String) The filepath to write to</p>

          <div class="method-source-code" id="write-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 1505</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">write</span>(<span class="ruby-identifier">file</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-value">backup:</span> <span class="ruby-keyword">true</span>)
  <span class="ruby-identifier">output</span> = <span class="ruby-ivar">@other_content_top</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{@other_content_top.join(&quot;\n&quot;)}\n&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-ivar">@content</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">title</span>, <span class="ruby-identifier">section</span><span class="ruby-operator">|</span>
    <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-node">&quot;#{section[&#39;original&#39;]}\n&quot;</span>
    <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-identifier">list_section</span>({ <span class="ruby-value">section:</span> <span class="ruby-identifier">title</span>, <span class="ruby-value">template:</span> <span class="ruby-string">&quot;\t- %date | %title%idnote&quot;</span>, <span class="ruby-value">highlight:</span> <span class="ruby-keyword">false</span> })
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">output</span> <span class="ruby-operator">+=</span> <span class="ruby-ivar">@other_content_bottom</span>.<span class="ruby-identifier">join</span>(<span class="ruby-string">&quot;\n&quot;</span>) <span class="ruby-keyword">unless</span> <span class="ruby-ivar">@other_content_bottom</span>.<span class="ruby-identifier">nil?</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">output</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">file</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">expand_path</span>(<span class="ruby-identifier">file</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-constant">File</span>.<span class="ruby-identifier">exist?</span>(<span class="ruby-identifier">file</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">backup</span>
      <span class="ruby-comment"># Create a backup copy for the undo command</span>
      <span class="ruby-constant">FileUtils</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-identifier">file</span>, <span class="ruby-node">&quot;#{file}~&quot;</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-constant">File</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">file</span>, <span class="ruby-string">&#39;w+&#39;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">f</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">f</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">output</span>
    <span class="ruby-keyword">end</span>

    <span class="ruby-keyword">if</span> <span class="ruby-ivar">@config</span>.<span class="ruby-identifier">key?</span>(<span class="ruby-string">&#39;run_after&#39;</span>)
      <span class="ruby-identifier">_</span>, <span class="ruby-identifier">_</span>, <span class="ruby-identifier">status</span> = <span class="ruby-constant">Open3</span>.<span class="ruby-identifier">capture3</span>(<span class="ruby-ivar">@config</span>[<span class="ruby-string">&#39;run_after&#39;</span>])
      <span class="ruby-keyword">if</span> <span class="ruby-identifier">status</span>.<span class="ruby-identifier">exitstatus</span>.<span class="ruby-identifier">positive?</span>
        <span class="ruby-identifier">warn</span> <span class="ruby-node">&quot;Error running #{@config[&#39;run_after&#39;]}&quot;</span>
        <span class="ruby-identifier">warn</span> <span class="ruby-identifier">stderr</span>
      <span class="ruby-keyword">end</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-yesterday" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">yesterday</span><span
            class="method-args">(section, times = nil, output = nil, opt = {})</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Show entries from the previous day</p>

<p>@param section (String) The section @param times (Bool) Show times @param output (String) Output format @param opt (Hash) Additional Options</p>

          <div class="method-source-code" id="yesterday-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 2082</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">yesterday</span>(<span class="ruby-identifier">section</span>, <span class="ruby-identifier">times</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">output</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">opt</span> = {})
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>] <span class="ruby-operator">||=</span> <span class="ruby-keyword">false</span>
  <span class="ruby-identifier">section</span> = <span class="ruby-identifier">guess_section</span>(<span class="ruby-identifier">section</span>)
  <span class="ruby-identifier">y</span> = (<span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span> <span class="ruby-operator">-</span> (<span class="ruby-value">60</span> <span class="ruby-operator">*</span> <span class="ruby-value">60</span> <span class="ruby-operator">*</span> <span class="ruby-value">24</span>)).<span class="ruby-identifier">strftime</span>(<span class="ruby-string">&#39;%Y-%m-%d&#39;</span>)
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>] = <span class="ruby-node">&quot;#{y} #{opt[:after]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>]
  <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>] = <span class="ruby-node">&quot;#{y} #{opt[:before]}&quot;</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>]

  <span class="ruby-identifier">options</span> = {
    <span class="ruby-value">after:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:after</span>],
    <span class="ruby-value">before:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:before</span>],
    <span class="ruby-value">count:</span> <span class="ruby-value">0</span>,
    <span class="ruby-value">order:</span> <span class="ruby-string">&#39;asc&#39;</span>,
    <span class="ruby-value">output:</span> <span class="ruby-identifier">output</span>,
    <span class="ruby-value">section:</span> <span class="ruby-identifier">section</span>,
    <span class="ruby-value">sort_tags:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:sort_tags</span>],
    <span class="ruby-value">tag_order:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:tag_order</span>],
    <span class="ruby-value">times:</span> <span class="ruby-identifier">times</span>,
    <span class="ruby-value">totals:</span> <span class="ruby-identifier">opt</span>[<span class="ruby-value">:totals</span>],
    <span class="ruby-value">yesterday:</span> <span class="ruby-keyword">true</span>
  }

  <span class="ruby-identifier">list_section</span>(<span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

      <div id="method-i-yn" class="method-detail ">
        <div class="method-heading">
          <span class="method-name">yn</span><span
            class="method-args">(question, default_response: false)</span>
          <span class="method-click-advice">click to toggle source</span>
        </div>

        <div class="method-description">
          <p>@brief Ask a yes or no question in the terminal</p>

<p>@param question (String) The question to ask @param default (Bool) default response if no input</p>

<p>@return (Bool) yes or no</p>

          <div class="method-source-code" id="yn-source">
            <pre><span class="ruby-comment"># File lib/doing/wwid.rb, line 468</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">yn</span>(<span class="ruby-identifier">question</span>, <span class="ruby-value">default_response:</span> <span class="ruby-keyword">false</span>)
  <span class="ruby-identifier">default</span> = <span class="ruby-identifier">default_response</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">default_response</span> <span class="ruby-operator">:</span> <span class="ruby-string">&#39;n&#39;</span>

  <span class="ruby-comment"># if this isn&#39;t an interactive shell, answer default</span>
  <span class="ruby-keyword">return</span> <span class="ruby-identifier">default</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;y&#39;</span> <span class="ruby-keyword">unless</span> <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">isatty</span>

  <span class="ruby-comment"># clear the buffer</span>
  <span class="ruby-keyword">if</span> <span class="ruby-constant">ARGV</span>&amp;.<span class="ruby-identifier">length</span>
    <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">length</span>.<span class="ruby-identifier">times</span> <span class="ruby-keyword">do</span>
      <span class="ruby-constant">ARGV</span>.<span class="ruby-identifier">shift</span>
    <span class="ruby-keyword">end</span>
  <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">system</span> <span class="ruby-string">&#39;stty cbreak&#39;</span>

  <span class="ruby-identifier">cw</span> = <span class="ruby-identifier">colors</span>[<span class="ruby-string">&#39;white&#39;</span>]
  <span class="ruby-identifier">cbw</span> = <span class="ruby-identifier">colors</span>[<span class="ruby-string">&#39;boldwhite&#39;</span>]
  <span class="ruby-identifier">cbg</span> = <span class="ruby-identifier">colors</span>[<span class="ruby-string">&#39;boldgreen&#39;</span>]
  <span class="ruby-identifier">cd</span> = <span class="ruby-identifier">colors</span>[<span class="ruby-string">&#39;default&#39;</span>]

  <span class="ruby-identifier">options</span> = <span class="ruby-keyword">if</span> <span class="ruby-identifier">default</span>
              <span class="ruby-identifier">default</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/y/i</span> <span class="ruby-operator">?</span> <span class="ruby-node">&quot;#{cw}[#{cbg}Y#{cw}/#{cbw}n#{cw}]#{cd}&quot;</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{cw}[#{cbw}y#{cw}/#{cbg}N#{cw}]#{cd}&quot;</span>
            <span class="ruby-keyword">else</span>
              <span class="ruby-node">&quot;#{cw}[#{cbw}y#{cw}/#{cbw}n#{cw}]#{cd}&quot;</span>
            <span class="ruby-keyword">end</span>
  <span class="ruby-identifier">$stdout</span>.<span class="ruby-identifier">syswrite</span> <span class="ruby-node">&quot;#{cbw}#{question.sub(/\?$/, &#39;&#39;)} #{options}#{cbw}?#{cd} &quot;</span>
  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">$stdin</span>.<span class="ruby-identifier">sysread</span> <span class="ruby-value">1</span>
  <span class="ruby-identifier">puts</span>
  <span class="ruby-identifier">system</span> <span class="ruby-string">&#39;stty cooked&#39;</span>

  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">chomp!</span>
  <span class="ruby-identifier">res</span>.<span class="ruby-identifier">downcase!</span>

  <span class="ruby-identifier">res</span> = <span class="ruby-identifier">default</span>.<span class="ruby-identifier">downcase</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">res</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;&#39;</span>

  <span class="ruby-identifier">res</span> <span class="ruby-operator">=~</span> <span class="ruby-regexp">/y/i</span>
<span class="ruby-keyword">end</span></pre>
          </div>
        </div>


      </div>

    </section>

  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.3.2.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

